/*!
 * Babel - The easy way for your multilingual site!
 * Version: 3.5.3
 * Build date: 2025-11-17
 */
var babel=function(e){babel.superclass.constructor.call(this,e=e||{})},Babel=(Ext.extend(babel,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},getMenu:function(t){var i=this,e=Ext.getCmp("modx-action-buttons");if(e){var s,n=[],o=0,l=0;for(s in t)s!==this.config.context_key&&(void 0!==t[s].resourceUrl&&""!==t[s].resourceUrl&&"#"!==t[s].resourceUrl?(n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-globe modx'+Babel.config.modxversion+'"></i>'+t[s].displayText,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-pencil-square-o modx'+Babel.config.modxversion+'"></i>'+_("babel.open")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",resourceUrl:t[s].resourceUrl,resourceId:t[s].resourceId,handler:function(){MODx.loadPage("resource/update","id="+this.resourceId)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-refresh modx'+Babel.config.modxversion+'"></i>'+_("babel.refresh")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",contextKey:s,handler:function(){i.refreshTranslation(this.contextKey,0)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-chain-broken modx'+Babel.config.modxversion+'"></i>'+_("babel.unlink")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",contextKey:s,handler:function(){i.unlinkTranslation(this.contextKey,0)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-trash-o modx'+Babel.config.modxversion+'"></i>'+_("babel.delete")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",contextKey:s,handler:function(){i.deleteTranslation(this.contextKey,0)}}]}}),o++):(n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-globe modx'+Babel.config.modxversion+'"></i>'+t[s].displayText,handler:Ext.emptyFn,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-plus-circle modx'+Babel.config.modxversion+'"></i>'+_("babel.create_translation"),contextKey:s,handler:function(){i.createTranslation(this.contextKey)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-link modx'+Babel.config.modxversion+'"></i>'+_("babel.link_translation"),contextKey:s,handler:function(){i.linkTranslation(this.contextKey)}}]}}),l++));0<o&&(n.push("-"),n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-refresh modx'+Babel.config.modxversion+'"></i>'+_("babel.refresh_multiple_translations"),handler:function(){i.refreshTranslation()}}),n.push("-"),n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-chain-broken modx'+Babel.config.modxversion+'"></i>'+_("babel.unlink_all_translations"),handler:function(){i.unlinkTranslation()}}),n.push("-"),n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-trash-o modx'+Babel.config.modxversion+'"></i>'+_("babel.delete_all_translations"),handler:function(){i.deleteTranslation()}})),0<l&&(n.push("-"),n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-plus-square modx'+Babel.config.modxversion+'"></i>'+_("babel.create_multiple_translations"),contextKey:s,target:t[s].resourceId,handler:function(){i.createTranslation()}})),n.push("-"),n.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-lightbulb-o modx'+Babel.config.modxversion+'"></i>'+_("babel.about"),handler:function(){i.aboutWindow()}});var a=Ext.getCmp("babel-language-select");a&&a.destroy(),a=new Ext.Button({id:"babel-language-select",text:"Select Language",menu:n,listeners:{render:{fn:function(e){e.setText(t[i.config.context_key].displayText)},scope:this},mouseover:function(e){e.showMenu(),this.menu.addClass("x-menu-babel")}}}),e.insertButton(0,[a]),e.doLayout()}},linkTranslation:function(i,e,t){var s=this,n=(e=e||MODx.request.id,MODx.load({xtype:"modx-window",title:_("babel.link_translation"),closeAction:"close",url:s.config.connectorUrl,baseParams:{action:"mgr/resource/link",context:i,id:e},fields:[{xtype:"textfield",fieldLabel:_("context"),anchor:"100%",disabled:!0,emptyText:i},{xtype:"modx-field-parent-change",fieldLabel:_("babel.select_tree_node"),id:"",name:"target-combo",anchor:"100%",end:function(e){var t=Ext.getCmp("modx-resource-tree");t&&(e.display=e.display||e.value,e.context===i)&&(t.removeListener("click",this.handleChangeParent,this),t.on("click",t._handleClick,t),t.disableHref=!1,n.fp.getForm().findField("target").setValue(e.value),n.fp.getForm().findField("page_id").setValue(null),this.setValue(e.display),this.oldValue=!1)},handleChangeParent:function(e,t){var i=Ext.getCmp("modx-resource-tree");return!!i&&(i.disableHref=!0,(i=e.id.split("_")[1])===this.config.currentid?(MODx.msg.alert("",_("resource_err_own_parent")),!1):(this.fireEvent("end",{value:"modContext"!==e.attributes.type?i:e.attributes.pk,display:Ext.util.Format.stripTags(e.text),context:e.attributes.ctx}),t.preventDefault(),t.stopEvent(),!0))}},{xtype:"modx-combo",fieldLabel:_("babel.target_pagetitle"),name:"page_id",anchor:"100%",url:s.config.connectorUrl,baseParams:{action:"mgr/resource/getlist",context:i,combo:!0},displayField:"pagetitle",valueField:"id",fields:["id","pagetitle"],editable:!0,typeAhead:!0,forceSelection:!0,listeners:{select:{fn:function(e,t){var i=e.getValue();""===i||0===i||"&nbsp;"===i?e.setValue(null):n.fp.getForm().findField("target").setValue(t.get("id")),n.fp.getForm().findField("target-combo").reset()},scope:this},blur:{fn:function(e){var t=e.getValue();""!==t&&0!==t&&"&nbsp;"!==t||e.setValue(null)},scope:this}}},{fieldLabel:_("babel.target_id"),xtype:"numberfield",name:"target",anchor:"100%",enableKeyEvents:!0,listeners:{keyup:{fn:function(){n.fp.getForm().findField("target-combo").reset(),n.fp.getForm().findField("page_id").reset()},scope:this}}},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_translations_target"),name:"sync",checked:!0}],listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("babel.link_successful")}),t?t.refresh():s.getMenu(e.a.result.object.menu),s.hideMask()},scope:this},failure:{fn:s.hideMask,scope:this},beforeSubmit:{fn:s.loadMask,scope:this}}}));n.show()},unlinkTranslation:function(e,t,i){this.unlinkDeleteTranslation(e,t,i,!0)},deleteTranslation:function(e,t,i){this.unlinkDeleteTranslation(e,t,i,!1)},unlinkDeleteTranslation:function(t,i,s,n){var o=this,e=(t=t||"",i=i||MODx.request.id,""===t?n?_("babel.unlink_all_translations_confirm"):_("babel.delete_all_translations_confirm"):n?_("babel.unlink_translation_confirm",{context:t,id:i}):_("babel.delete_translation_confirm",{context:t,id:i})),l=MODx.load({xtype:"modx-window",title:""===t?n?_("babel.unlink_all_translations"):_("babel.delete_all_translations"):n?_("babel.unlink_translation"):_("babel.delete_translation"),closeAction:"close",fields:[{style:"padding-top: 15px",html:"<p>"+e+"</p>"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:n?_("babel.unlink_child_translations"):_("babel.delete_child_translations"),name:"child",checked:!1}],buttons:[{text:_("close"),handler:function(){l.close()},scope:this},{text:n?_("babel.unlink"):_("babel.delete"),cls:"primary-button",handler:function(){var e=l.fp.getForm().getValues();l.close(),"1"===e.child?(e.contexts=t,o.dropTranslations(i,n,e)):MODx.Ajax.request({url:this.config.connectorUrl,params:{action:n?"mgr/resource/unlink":"mgr/resource/delete",context_key:t,id:i},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||(n?_("babel.unlink_successful"):_("babel.delete_successful"))});var t=Ext.getCmp("modx-resource-tree");s?(s.refresh(),t&&t.rendered&&t.refresh()):(o.getMenu(e.object.menu),n||t&&t.rendered&&t.refresh()),o.hideMask()},scope:this},failure:{fn:o.hideMask,scope:this}}})},scope:this}],listeners:{beforeSubmit:{fn:o.loadMask,scope:this},close:{fn:o.hideMask,scope:this}}});l.show()},dropTranslations:function(t,i,s){var n=this;n.contexts=s.hasOwnProperty("contexts")?Array.isArray(s.contexts)?s.contexts:[s.contexts]:[],delete s.contexts,MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/getchildren",id:t,getchildren:s.child},listeners:{success:{fn:function(e){e.object.child_ids&&(delete s.child,this.child_ids=e.object.child_ids,e="/babeldrop/",MODx.load({xtype:"modx-console",register:"mgr",topic:e,show_filename:!1,clear:!0,listeners:{complete:{fn:function(){var e=MODx.request.id,e=(MODx.msg.status({title:_("success"),message:i?_("babel.unlink_multiple_translations_finished"):_("babel.delete_multiple_translations_finished")}),MODx.Ajax.request({url:n.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:e},listeners:{success:{fn:function(e){var t;n.hideMask(),e.object.menu&&(n.getMenu(e.object.menu),t=Ext.getCmp("modx-resource-tree"))&&t.rendered&&(t=t.getTopToolbar().findById("emptifier"))&&(0===e.object.deletedCount?t.disable():t.enable(),t.setTooltip(_("trash.manage_recycle_bin_tooltip",{count:e.object.deletedCount})))},scope:this}}}),Ext.getCmp("modx-resource-tree"));e&&e.rendered&&e.refresh(),n.hideMask()},scope:this}}}).show(Ext.getBody()),n.dropTranslation(0,0,"mgr",e,t,i,s))},scope:this}}})},dropTranslation:function(e,t,i,s,n,o,l){var a=this;MODx.Ajax.request({url:this.config.connectorUrl,params:{action:o?"mgr/resource/unlink":"mgr/resource/delete",register:i,topic:s,id:a.child_ids[t],context_key:a.contexts[e],last:e===a.contexts.length-1&&t===a.child_ids.length-1},listeners:{success:{fn:function(){(t+=1)===a.child_ids.length&&(e+=1,t=0),e<a.contexts.length&&a.dropTranslation(e,t,i,s,n,o,l)},scope:this},failure:{fn:function(){(t+=1)===a.child_ids.length&&(e+=1,t=0),e<a.contexts.length&&a.dropTranslation(e,t,i,s,n,o,l)},scope:this}}})},createTranslation:function(t,i=0){var s,n=this;i=i||MODx.request.id,this.loadMask(),t?(s=MODx.load({xtype:"modx-window",title:_("babel.create_translation"),closeAction:"close",fields:[{style:"padding-top: 15px",html:"<p>"+_("babel.create_translation_confirm",{context:t,id:i})+"</p>"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_translations"),name:"sync",checked:!0},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.create_child_translations"),name:"child",checked:!1}],buttons:[{text:_("close"),handler:function(){s.close()},scope:this},{text:_("create"),cls:"primary-button",handler:function(){var e=s.fp.getForm().getValues();s.close(),"1"===e.child?(e.contexts=t,n.addTranslations(i,e)):MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",context_key:t,id:i,copy:e.copy,sync:e.sync},listeners:{success:{fn:function(e){n.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this}}})},scope:this}],listeners:{beforeSubmit:{fn:n.loadMask,scope:this},close:{fn:n.hideMask,scope:this}}})).show():Babel.config.hasOwnProperty("menu")&&Babel.config.hasOwnProperty("context_key")?(n.babelMenu=Babel.config.menu,n.babelContext=Babel.config.context_key,n.createTranslations(t,i)):MODx.Ajax.request({url:n.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:i},listeners:{success:{fn:function(e){e.object.menu&&e.object.context_key&&(n.babelMenu=e.object.menu,n.babelContext=e.object.context_key,n.createTranslations(t,i))},scope:this}}})},createTranslations:function(e,t){var i,s=this,n=[];Ext.each(Babel.config.contexts,function(e){e===s.babelContext||!s.babelMenu.hasOwnProperty(e)||"undefined"!==s.babelMenu[e].resourceUrl&&""!==s.babelMenu[e].resourceUrl&&"#"!==s.babelMenu[e].resourceUrl||n.push({boxLabel:s.babelMenu[e].displayText,name:"contexts",inputValue:e})}),n.length?(i=MODx.load({xtype:"modx-window",title:_("babel.create_multiple_translations"),closeAction:"close",width:500,fields:[{xtype:"fieldset",cls:"x-fieldset-check-all",title:_("babel.contexts"),defaults:{hideLabel:!0},items:[{xtype:"xcheckbox",id:"babel-all-contexts",boxLabel:_("babel.all"),itemCls:"x-form-item-check-all",submitValue:!1,listeners:{check:{fn:function(t){var i=[],e=Ext.getCmp("babel-contexts");Ext.each(Babel.config.contexts,function(e){e!==s.babelContext&&s.babelMenu.hasOwnProperty(e)&&i.push(t.getValue())}),e.setValue(i)},scope:this}}},{xtype:"checkboxgroup",id:"babel-contexts",columns:3,anchor:"100%",style:"margin-top: -10px",items:n}]},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_translations"),name:"sync",checked:!0},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.create_child_translations"),name:"child",checked:!1}],buttons:[{text:_("close"),handler:function(){i.close()},scope:this},{text:_("create"),cls:"primary-button",handler:function(){var e=i.fp.getForm().getValues();i.close(),s.addTranslations(t,e)},scope:this}],listeners:{beforeSubmit:{fn:s.loadMask,scope:this},close:{fn:s.hideMask,scope:this},afterrender:function(){var e=Ext.getCmp("babel-all-contexts");e&&e.setValue(1)}}})).show():(MODx.msg.alert("",_("babel.create_multiple_translations_err_no_contexts")),s.hideMask())},addTranslations:function(t,i){var s=this;s.contexts=i.hasOwnProperty("contexts")?Array.isArray(i.contexts)?i.contexts:[i.contexts]:[],delete i.contexts,MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/getchildren",id:t,getchildren:i.child},listeners:{success:{fn:function(e){e.object.child_ids&&(delete i.child,this.child_ids=e.object.child_ids,e="/babeladd/",MODx.load({xtype:"modx-console",register:"mgr",topic:e,show_filename:!1,clear:!0,listeners:{complete:{fn:function(){var e=MODx.request.id,e=(MODx.msg.status({title:_("success"),message:_("babel.create_multiple_translations_finished")}),MODx.Ajax.request({url:s.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:e},listeners:{success:{fn:function(e){s.hideMask(),e.object.menu&&s.getMenu(e.object.menu)},scope:this}}}),Ext.getCmp("modx-resource-tree"));e&&e.rendered&&e.refresh(),s.hideMask()},scope:this}}}).show(Ext.getBody()),s.addTranslation(0,0,"mgr",e,t,i))},scope:this}}})},addTranslation:function(e,t,i,s,n,o){var l=this;MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",register:i,topic:s,id:l.child_ids[t],context_key:l.contexts[e],last:e===l.contexts.length-1&&t===l.child_ids.length-1,copy:o.copy,sync:o.sync},listeners:{success:{fn:function(){(t+=1)===l.child_ids.length&&(e+=1,t=0),e<l.contexts.length&&l.addTranslation(e,t,i,s,n,o)},scope:this},failure:{fn:function(){(t+=1)===l.child_ids.length&&(e+=1,t=0),e<l.contexts.length&&l.addTranslation(e,t,i,s,n,o)},scope:this}}})},refreshTranslation:function(t,i=0){var s,n=this;i=i||MODx.request.id,this.loadMask(),t?(s=MODx.load({xtype:"modx-window",title:_("babel.refresh_translation"),closeAction:"close",fields:[{style:"padding-top: 15px",html:"<p>"+_("babel.refresh_translation_confirm",{context:t,id:i})+"</p>"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_translations"),name:"sync",checked:!0},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.refresh_child_translations"),name:"child",checked:!1}],buttons:[{text:_("close"),handler:function(){s.close()},scope:this},{text:_("update"),cls:"primary-button",handler:function(){var e=s.fp.getForm().getValues();s.close(),"1"===e.child?(e.contexts=t,n.resetTranslations(i,e)):MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/refresh",context_key:t,id:i,copy:e.copy,sync:e.sync},listeners:{success:{fn:function(e){n.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this}}})},scope:this}],listeners:{beforeSubmit:{fn:n.loadMask,scope:this},close:{fn:n.hideMask,scope:this}}})).show():Babel.config.hasOwnProperty("menu")&&Babel.config.hasOwnProperty("context_key")?(n.babelMenu=Babel.config.menu,n.babelContext=Babel.config.context_key,n.refreshTranslations(t,i)):MODx.Ajax.request({url:n.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:i},listeners:{success:{fn:function(e){e.object.menu&&e.object.context_key&&(n.babelMenu=e.object.menu,n.babelContext=e.object.context_key,n.refreshTranslations(t,i))},scope:this}}})},refreshTranslations:function(e,t){var i,s=this,n=[];Ext.each(Babel.config.contexts,function(e){s.babelMenu[e];e!==s.babelContext&&s.babelMenu.hasOwnProperty(e)&&"undefined"!==s.babelMenu[e].resourceUrl&&""!==s.babelMenu[e].resourceUrl&&"#"!==s.babelMenu[e].resourceUrl&&n.push({boxLabel:s.babelMenu[e].displayText,name:"contexts",inputValue:e})}),n.length?(i=MODx.load({xtype:"modx-window",title:_("babel.refresh_multiple_translations"),closeAction:"close",fields:[{xtype:"fieldset",cls:"x-fieldset-check-all",title:_("babel.contexts"),defaults:{hideLabel:!0},items:[{xtype:"xcheckbox",id:"babel-all-contexts",boxLabel:_("babel.all"),itemCls:"x-form-item-check-all",submitValue:!1,listeners:{check:{fn:function(t){var i=[],e=Ext.getCmp("babel-contexts");Ext.each(Babel.config.contexts,function(e){e!==s.babelContext&&s.babelMenu.hasOwnProperty(e)&&i.push(t.getValue())}),e.setValue(i)},scope:this}}},{xtype:"checkboxgroup",id:"babel-contexts",columns:3,anchor:"100%",style:"margin-top: -10px",items:n}]},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_translations"),name:"sync",checked:!0},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.refresh_child_translations"),name:"child",checked:!1}],buttons:[{text:_("close"),handler:function(){i.close()},scope:this},{text:_("update"),cls:"primary-button",handler:function(){var e=i.fp.getForm().getValues();i.close(),s.resetTranslations(t,e)},scope:this}],listeners:{beforeSubmit:{fn:s.loadMask,scope:this},close:{fn:s.hideMask,scope:this},afterrender:function(){var e=Ext.getCmp("babel-all-contexts");e&&e.setValue(1)}}})).show():(MODx.msg.alert("",_("babel.refresh_multiple_translations_err_no_contexts")),s.hideMask())},resetTranslations:function(t,i){var s=this;s.contexts=i.hasOwnProperty("contexts")?Array.isArray(i.contexts)?i.contexts:[i.contexts]:[],delete i.contexts,MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/getchildren",id:t,getchildren:i.child},listeners:{success:{fn:function(e){e.object.child_ids&&(delete i.child,this.child_ids=e.object.child_ids,e="/babelrefresh/",MODx.load({xtype:"modx-console",register:"mgr",topic:e,show_filename:!1,clear:!0,listeners:{complete:{fn:function(){var e=MODx.request.id,e=(MODx.msg.status({title:_("success"),message:_("babel.refresh_multiple_translations_finished")}),MODx.Ajax.request({url:s.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:e},listeners:{success:{fn:function(e){s.hideMask(),e.object.menu&&s.getMenu(e.object.menu)},scope:this}}}),Ext.getCmp("modx-resource-tree"));e&&e.rendered&&e.refresh(),s.hideMask()},scope:this}}}).show(Ext.getBody()),s.resetTranslation(0,0,"mgr",e,t,i))},scope:this}}})},resetTranslation:function(e,t,i,s,n,o){var l=this;MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/refresh",register:i,topic:s,id:l.child_ids[t],context_key:l.contexts[e],last:e===l.contexts.length-1&&t===l.child_ids.length-1,copy:o.copy,sync:o.sync},listeners:{success:{fn:function(){(t+=1)===l.child_ids.length&&(e+=1,t=0),e<l.contexts.length&&l.resetTranslation(e,t,i,s,n,o)},scope:this},failure:{fn:function(){(t+=1)===l.child_ids.length&&(e+=1,t=0),e<l.contexts.length&&l.resetTranslation(e,t,i,s,n,o)},scope:this}}})},getChildIds:function(e){return MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/getchildren",id:e},listeners:{success:{fn:function(e){if(e.object.child_ids)return e.object.child_ids},scope:this}}}),[e]},loadMask:function(){var e;this.overlayMask||(e=Ext.getBody().dom,this.overlayMask=new Ext.LoadMask(e,{msg:_("babel.please_wait")})),this.overlayMask.show()},hideMask:function(){this.overlayMask&&this.overlayMask.hide()},aboutWindow:function(){Ext.Msg.show({title:_("babel")+" "+Babel.config.version,msg:'&copy; 2010-2025 by Jakob Class<br><br>Authors: <a href="https://github.com/mikrobi">Jakob Class</a>, <a href="https://github.com/goldsky">Rico Goldsky</a>, <a href="https://github.com/JoshuaLuckers">Joshua Luckers</a>, <a href="https://github.com/Jako">Thomas Jakobi</a><br><br>Repository: <a href="https://github.com/mikrobi/babel">github.com/mikrobi/babel</a>',buttons:Ext.Msg.OK,cls:"babel_window",width:358})}}),Ext.reg("babel",babel),new babel);Babel.combo.Context=function(e){e=e||{},Ext.applyIf(e,{url:Babel.config.connectorUrl,baseParams:{action:"mgr/context/getlist",combo:!0,exclude:"mgr"},tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name:htmlEncode}</span> <tpl if="key"><span style="font-style: italic; font-size: small;">({key:htmlEncode})</span></tpl></div></tpl>')}),Babel.combo.Context.superclass.constructor.call(this,e)},Ext.extend(Babel.combo.Context,MODx.combo.Context,{setValue:function(e){Babel.combo.Context.superclass.setValue.call(this,e=""===e?null:e)}}),Ext.reg("babel-combo-context",Babel.combo.Context),Ext.ns("Ext.ux.grid"),Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:!1,initTemplates:function(){var e=this.templates||{};e.masterTpl||(e.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")),this.templates=e,Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(e){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),t=e.child("div.x-grid3-locked"),i=t.child("div.x-grid3-header"),s=t.child("div.x-grid3-scroller"),n=e.child("div.x-grid3-viewport"),o=n.child("div.x-grid3-header"),l=n.child("div.x-grid3-scroller");this.grid.hideHeaders&&(i.setDisplayed(!1),o.setDisplayed(!1)),this.forceFit&&l.setStyle("overflow-x","hidden"),Ext.apply(this,{el:e,mainWrap:n,mainHd:o,innerHd:o.dom.firstChild,scroller:l,mainBody:l.child("div.x-grid3-body"),focusEl:l.child("a"),resizeMarker:e.child("div.x-grid3-resize-marker"),resizeProxy:e.child("div.x-grid3-resize-proxy"),lockedWrap:t,lockedHd:i,lockedScroller:s,lockedBody:s.child("div.x-grid3-body"),lockedInnerHd:i.child("div.x-grid3-header-inner",!0)}),this.focusEl.swallowEvent("click",!0)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(e){return this.getLockedRows()[e]},getCell:function(e,t){var i=this.cm.getLockedCount();return t<i?this.getLockedRow(e).getElementsByTagName("td")[t]:Ext.ux.grid.LockingGridView.superclass.getCell.call(this,e,t-i)},getHeaderCell:function(e){var t=this.cm.getLockedCount();return e<t?this.lockedHd.dom.getElementsByTagName("td")[e]:Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,e-t)},addRowClass:function(e,t){var i=this.getLockedRow(e);i&&this.fly(i).addClass(t),Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,e,t)},removeRowClass:function(e,t){var i=this.getLockedRow(e);i&&this.fly(i).removeClass(t),Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,e,t)},removeRow:function(e){Ext.removeNode(this.getLockedRow(e)),Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,e)},removeRows:function(e,t){for(var i=this.lockedBody.dom,s=e;s<=t;s++)Ext.removeNode(i.childNodes[e]);Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,e,t)},syncScroll:function(e){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop,Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,e)},updateSortIcon:function(e,t){var i=this.sortClasses,s=this.lockedHd.select("td").removeClass(i),n=this.mainHd.select("td").removeClass(i),o=this.cm.getLockedCount(),i=i["DESC"==t?1:0];(e<o?s.item(e):n.item(e-o)).addClass(i)},updateAllColumnWidths:function(){var e=this.getTotalWidth(),t=this.cm.getColumnCount(),i=this.getLockedWidth(),s=this.cm.getLockedCount(),n=[];for(this.updateLockedWidth(),d=0;d<t;d++)n[d]=this.getColumnWidth(d),this.getHeaderCell(d).style.width=n[d];for(var o,l,a,r=this.getLockedRows(),c=this.getRows(),d=0,h=c.length;d<h;d++){if((o=r[d]).style.width=i,o.firstChild)for(o.firstChild.style.width=i,l=o.firstChild.rows[0],a=0;a<s;a++)l.childNodes[a].style.width=n[a];if((o=c[d]).style.width=e,o.firstChild)for(o.firstChild.style.width=e,l=o.firstChild.rows[0],a=s;a<t;a++)l.childNodes[a-s].style.width=n[a]}this.onAllColumnWidthsUpdated(n,e),this.syncHeaderHeight()},updateColumnWidth:function(e,t){var i,s,n,o,l=this.getColumnWidth(e),a=this.cm.getLockedCount();this.updateLockedWidth(),n=e<a?(i=this.getLockedRows(),s=this.getLockedWidth(),e):(i=this.getRows(),s=this.getTotalWidth(),e-a),this.getHeaderCell(e).style.width=l;for(var r=0,c=i.length;r<c;r++)(o=i[r]).style.width=s,o.firstChild&&(o.firstChild.style.width=s,o.firstChild.rows[0].childNodes[n].style.width=l);this.onColumnWidthUpdated(e,l,this.getTotalWidth()),this.syncHeaderHeight()},updateColumnHidden:function(e,t){var i,s,n,o,l=this.cm.getLockedCount(),a=t?"none":"";this.updateLockedWidth(),n=e<l?(i=this.getLockedRows(),s=this.getLockedWidth(),e):(i=this.getRows(),s=this.getTotalWidth(),e-l),this.getHeaderCell(e).style.display=a;for(var r=0,c=i.length;r<c;r++)(o=i[r]).style.width=s,o.firstChild&&(o.firstChild.style.width=s,o.firstChild.rows[0].childNodes[n].style.display=a);this.onColumnHiddenUpdated(e,t,this.getTotalWidth()),delete this.lastViewWidth,this.layout()},doRender:function(e,t,i,s,n,o){for(var l,a=this.templates,r=a.cell,c=a.row,d=n-1,h="width:"+this.getTotalWidth()+";",u="width:"+this.getLockedWidth()+";",b=[],g=[],x={},m={},p=0,f=t.length;p<f;p++){for(var y=t[p],k=[],_=[],v=p+s,w=0;w<n;w++)l=e[w],x.id=l.id,x.css=(0===w?"x-grid3-cell-first ":w==d?"x-grid3-cell-last ":"")+(this.cm.config[w].cellCls?" "+this.cm.config[w].cellCls:""),x.attr=x.cellAttr="",x.value=l.renderer(y.data[l.name],x,y,v,w,i),x.style=l.style,Ext.isEmpty(x.value)&&(x.value="&#160;"),this.markDirty&&y.dirty&&Ext.isDefined(y.modified[l.name])&&(x.css+=" x-grid3-dirty-cell"),l.locked?_[_.length]=r.apply(x):k[k.length]=r.apply(x);var C=[];o&&(v+1)%2==0&&(C[0]="x-grid3-row-alt"),y.dirty&&(C[1]=" x-grid3-dirty-row"),m.cols=n,this.getRowClass&&(C[2]=this.getRowClass(y,v,m,i)),m.alt=C.join(" "),m.cells=k.join(""),m.tstyle=h,b[b.length]=c.apply(m),m.cells=_.join(""),m.tstyle=u,g[g.length]=c.apply(m)}return[b.join(""),g.join("")]},processRows:function(e,t){if(this.ds&&!(this.ds.getCount()<1)){var i,s,n=this.getRows(),o=this.getLockedRows();t=t||!this.grid.stripeRows,e=e||0;for(var l=0,a=n.length;l<a;++l)i=n[l],s=o[l],i.rowIndex=l,s.rowIndex=l,t||(i.className=i.className.replace(this.rowClsRe," "),s.className=s.className.replace(this.rowClsRe," "),(l+1)%2==0&&(i.className+=" x-grid3-row-alt",s.className+=" x-grid3-row-alt")),this.syncRowHeights(i,s);0===e&&(Ext.fly(n[0]).addClass(this.firstRowCls),Ext.fly(o[0]).addClass(this.firstRowCls)),Ext.fly(n[n.length-1]).addClass(this.lastRowCls),Ext.fly(o[o.length-1]).addClass(this.lastRowCls)}},syncRowHeights:function(e,t){var i,s;this.syncHeights&&(e=Ext.get(e),t=Ext.get(t),i=e.getHeight(),(s=t.getHeight())<i?t.setHeight(i):i<s&&e.setHeight(s))},afterRender:function(){var e;this.ds&&this.cm&&(e=this.renderRows()||["&#160;","&#160;"],this.mainBody.dom.innerHTML=e[0],this.lockedBody.dom.innerHTML=e[1],this.processRows(0,!0),!0!==this.deferEmptyText&&this.applyEmptyText(),this.grid.fireEvent("viewready",this.grid))},renderUI:function(){var e=this.templates,t=this.renderHeaders(),i=e.body.apply({rows:"&#160;"});return e.masterTpl.apply({body:i,header:t[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:i,lockedHeader:t[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var e=this.grid;this.initElements(),Ext.fly(this.innerHd).on("click",this.handleHdDown,this),Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this),this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.scroller.on("scroll",this.syncScroll,this),!1!==e.enableColumnResize&&(this.splitZone=new Ext.grid.GridView.SplitDragZone(e,this.mainHd.dom),this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom)),this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))),e.enableColumnMove&&(this.columnDrag=new Ext.grid.GridView.ColumnDragZone(e,this.innerHd),this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd)),this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd)),this.columnDrop=new Ext.grid.HeaderDropZone(e,this.mainHd.dom)),!1!==e.enableHdMenu&&(this.hmenu=new Ext.menu.Menu({id:e.id+"-hctx"}),this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),!1!==this.grid.enableColLock&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"}),!1!==e.enableColumnHide&&(this.colMenu=new Ext.menu.Menu({id:e.id+"-hcols-menu"}),this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick}),this.hmenu.add("-",{itemId:"columns",hideOnClick:!1,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})),this.hmenu.on("itemclick",this.handleHdMenuClick,this)),e.trackMouseOver&&(this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut}),this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})),(e.enableDragDrop||e.enableDrag)&&(this.dragZone=new Ext.grid.GridDragZone(e,{ddGroup:e.ddGroup||"GridDD"})),this.updateHeaderSortState()},layout:function(){var e,t,i,s;this.mainBody&&(t=(e=(i=this.grid).getGridEl().getSize(!0)).width,!i.hideHeaders&&(t<20||e.height<20)||(this.syncHeaderHeight(),i.autoHeight?(this.scroller.dom.style.overflow="visible",this.lockedScroller.dom.style.overflow="visible",Ext.isWebKit&&(this.scroller.dom.style.position="static",this.lockedScroller.dom.style.position="static")):(this.el.setSize(e.width,e.height),i=this.mainHd.getHeight(),s=e.height-i),this.updateLockedWidth(),this.forceFit?this.lastViewWidth!=t&&(this.fitColumns(!1,!1),this.lastViewWidth=t):(this.autoExpand(),this.syncHeaderScroll()),this.onLayout(t,s)))},getOffsetWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){for(var e=this.cm,t=this.templates,i=t.hcell,s=[],n=[],o={},l=e.getColumnCount(),a=l-1,r=0;r<l;r++)o.id=e.getColumnId(r),o.value=e.getColumnHeader(r)||"",o.style=this.getColumnStyle(r,!0),o.tooltip=this.getColumnTooltip(r),o.css=(0===r?"x-grid3-cell-first ":r==a?"x-grid3-cell-last ":"")+(e.config[r].headerCls?" "+e.config[r].headerCls:""),"right"==e.config[r].align?o.istyle="padding-right:16px":delete o.istyle,e.isLocked(r)?n[n.length]=i.apply(o):s[s.length]=i.apply(o);return[t.header.apply({cells:s.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),t.header.apply({cells:n.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var e=this.renderHeaders(),e=(this.innerHd.firstChild.innerHTML=e[0],this.innerHd.firstChild.style.width=this.getOffsetWidth(),this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth(),this.lockedInnerHd.firstChild.innerHTML=e[1],this.getLockedWidth());this.lockedInnerHd.firstChild.style.width=e,this.lockedInnerHd.firstChild.firstChild.style.width=e},getResolvedXY:function(e){var t;return e?(t=e.cell,e=e.row,t?Ext.fly(t).getXY():[this.scroller.getX(),Ext.fly(e).getY()]):null},syncFocusEl:function(e,t,i){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,e,t,!(t<this.cm.getLockedCount())&&i)},ensureVisible:function(e,t,i){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,e,t,!(t<this.cm.getLockedCount())&&i)},insertRows:function(e,t,i,s){var n,o,e=e.getCount()-1;!s&&0===t&&e<=i?this.refresh():(s||this.fireEvent("beforerowsinserted",this,t,i),n=this.renderRows(t,i),(o=this.getRow(t))?(0===t&&this.removeRowClass(0,this.firstRowCls),Ext.DomHelper.insertHtml("beforeBegin",o,n[0]),o=this.getLockedRow(t),Ext.DomHelper.insertHtml("beforeBegin",o,n[1])):(this.removeRowClass(e-1,this.lastRowCls),Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,n[0]),Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,n[1])),s?(0===t||e<=t)&&this.addRowClass(t,0===t?this.firstRowCls:this.lastRowCls):(this.fireEvent("rowsinserted",this,t,i),this.processRows(t))),this.syncFocusEl(t)},getColumnStyle:function(e,t){t=t?this.cm.config[e].headerStyle||"":this.cm.config[e].cellStyle||this.cm.config[e].css||"",t+="width:"+this.getColumnWidth(e)+";",this.cm.isHidden(e)&&(t+="display:none;"),e=this.cm.config[e].align;return e&&(t+="text-align:"+e+";"),t},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var e=[],t=this.cm,i=t.getColumnCount(),s=0;s<i;s++){var n=t.getDataIndex(s);e[s]={name:Ext.isDefined(n)?n:this.ds.fields.get(s).name,renderer:t.getRenderer(s),scope:t.getRendererScope(s),id:t.getColumnId(s),style:this.getColumnStyle(s),locked:t.isLocked(s)}}return e},renderBody:function(){var e=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:e[0]}),this.templates.body.apply({rows:e[1]})]},refreshRow:function(e){var t,i,s,n,o,l,a=this.ds,r=this.cm.getColumnCount(),c=this.getColumnData(),d=r-1,h=["x-grid3-row"],u={tstyle:String.format("width: {0};",this.getTotalWidth())},b={tstyle:String.format("width: {0};",this.getLockedWidth())},g=[],x=[],m=this.templates.cell;if(Ext.isNumber(e)?(t=e,e=a.getAt(t)):t=a.indexOf(e),e&&!(t<0)){for(l=0;l<r;l++)(o={id:(n=c[l]).id,style:n.style,css:0==l?"x-grid3-cell-first":l==d?"x-grid3-cell-last ":"",attr:"",cellAttr:""}).value=n.renderer.call(n.scope,e.data[n.name],o,e,t,l,a),Ext.isEmpty(o.value)&&(o.value=" "),this.markDirty&&e.dirty&&void 0!==e.modified[n.name]&&(o.css+=" x-grid3-dirty-cell"),n.locked?x[l]=m.apply(o):g[l]=m.apply(o);(i=this.getRow(t)).className="",(s=this.getLockedRow(t)).className="",this.grid.stripeRows&&(t+1)%2==0&&h.push("x-grid3-row-alt"),this.getRowClass&&(u.cols=r,h.push(this.getRowClass(e,t,u,a))),this.fly(i).addClass(h).setStyle(u.tstyle),u.cells=g.join(""),i.innerHTML=this.templates.rowInner.apply(u),this.fly(s).addClass(h).setStyle(b.tstyle),b.cells=x.join(""),s.innerHTML=this.templates.rowInner.apply(b),s.rowIndex=t,this.syncRowHeights(i,s),this.fireEvent("rowupdated",this,t,e)}},refresh:function(e){this.fireEvent("beforerefresh",this),this.grid.stopEditing(!0);var t=this.renderBody();this.mainBody.update(t[0]).setWidth(this.getTotalWidth()),this.lockedBody.update(t[1]).setWidth(this.getLockedWidth()),!0===e&&(this.updateHeaders(),this.updateHeaderSortState()),this.processRows(0,!0),this.layout(),this.applyEmptyText(),this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(e,t){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this),Ext.ux.grid.LockingGridView.superclass.initData.call(this,e,t),this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(!0)},handleHdMenuClick:function(e){var t=this.hdCtxIndex,i=this.cm,s=e.getItemId(),n=i.getLockedCount();switch(s){case"lock":if(i.getColumnCount(!0)<=n+1)return void this.onDenyColumnLock();i.setLocked(t,!0,n!=t),n!=t&&(i.moveColumn(t,n),this.grid.fireEvent("columnmove",t,n));break;case"unlock":n-1!=t?(i.setLocked(t,!1,!0),i.moveColumn(t,n-1),this.grid.fireEvent("columnmove",t,n-1)):i.setLocked(t,!1);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,e)}return!0},handleHdDown:function(e,t){var i;Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,e,t),!1!==this.grid.enableColLock&&Ext.fly(t).hasClass("x-grid3-hd-btn")&&(e=this.findHeaderCell(t),t=this.getCellIndex(e),e=this.hmenu.items,i=this.cm,e.get("lock").setDisabled(i.isLocked(t)),e.get("unlock").setDisabled(!i.isLocked(t)))},syncHeaderHeight:function(){var e=Ext.fly(this.innerHd).child("tr",!0),t=Ext.fly(this.lockedInnerHd).child("tr",!0),i=(e.style.height="auto",t.style.height="auto",e.offsetHeight),i=Math.max(t.offsetHeight,i)+"px";e.style.height=i,t.style.height=i},updateLockedWidth:function(){var e=this.cm.getTotalLockedWidth(),t=this.cm.getTotalWidth()-e,i=this.grid.getGridEl().getSize(!0),s=Ext.isBorderBox?0:this.lockedBorderWidth,n=Ext.isBorderBox?0:this.rowBorderWidth,o=Math.max(i.width-e-s-n,0)+"px",l=this.getScrollOffset();this.grid.autoHeight||(i=Math.max(i.height-this.mainHd.getHeight(),0)+"px",this.lockedScroller.dom.style.height=i,this.scroller.dom.style.height=i),this.lockedWrap.dom.style.width=e+n+"px",this.scroller.dom.style.width=o,this.mainWrap.dom.style.left=e+s+n+"px",this.innerHd&&(this.lockedInnerHd.firstChild.style.width=e+"px",this.lockedInnerHd.firstChild.firstChild.style.width=e+"px",this.innerHd.style.width=o,this.innerHd.firstChild.style.width=t+n+l+"px",this.innerHd.firstChild.firstChild.style.width=t+"px"),this.mainBody&&(this.lockedBody.dom.style.width=e+n+"px",this.mainBody.dom.style.width=t+n+"px")}}),Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(e){return!0===this.config[e].locked},setLocked:function(e,t,i){this.isLocked(e)==t||(this.config[e].locked=t,i)||this.fireEvent("columnlockchange",this,e,t)},getTotalLockedWidth:function(){for(var e=0,t=0,i=this.config.length;t<i;t++)this.isLocked(t)&&!this.isHidden(t)&&(e+=this.getColumnWidth(t));return e},getLockedCount:function(){for(var e=this.config.length,t=0;t<e;t++)if(!this.isLocked(t))return t;return e},moveColumn:function(e,t){var i=this.isLocked(e),s=this.isLocked(t);e<t&&i&&!s?this.setLocked(e,!1,!0):t<e&&!i&&s&&this.setLocked(e,!0,!0),Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}}),Babel.grid.ResourceMatrix=function(e){e=e||{},this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}" data-ctx="{ctx}" data-target="{target}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.ident="babel-resourcematrix-"+Ext.id();var t=this,i=[],s=["id","context_key","pagetitle","parent"],n=[],o=(e.contexts&&(i=[{header:_("id"),width:70,sortable:!0,dataIndex:"id",locked:!0,id:"res_id"},{header:_("context"),width:80,sortable:!0,dataIndex:"context_key",locked:!0,id:"context_key"},{header:_("pagetitle"),width:200,sortable:!0,dataIndex:"pagetitle",locked:!0,id:"pagetitle"},{header:_("babel.all"),renderer:this.buttonColumnAllRenderer.bind(this),menuDisabled:!0,fixed:!0,locked:!0,width:85}],Ext.each(e.contexts,function(e){s.push("linkedres_id_"+e),s.push("linkedres_pagetitle_"+e),n.push(e),i.push({header:e,width:85,sortable:!1,dataIndex:"linkedres_id_"+e,id:"linkedres_id_"+e,menuDisabled:!0,renderer:t.buttonColumnContextRenderer.bind(t)})})),new Ext.ux.grid.LockingColumnModel({columns:i}));Ext.apply(e,{url:Babel.config.connectorUrl,baseParams:{action:"mgr/resource/getmatrixlist",contexts:n.toString(),limit:0},colModel:o,fields:s,paging:!0,remoteSort:!0,anchor:"100%",view:new Ext.ux.grid.LockingGridView,autoHeight:!1,showActionsColumn:!1,tbar:[{xtype:"babel-combo-context",id:this.ident+"-filter-context",emptyText:_("babel.select_context"),listeners:{select:{fn:this.filterByContext,scope:this}}},"->",{xtype:"textfield",id:this.ident+"-filter-query",cls:"x-form-filter",emptyText:_("babel.search"),width:300,listeners:{change:{fn:this.filterByQuery,scope:this},render:{fn:function(e){new Ext.KeyMap(e.getEl(),{key:Ext.EventObject.ENTER,fn:this.blur,scope:e})},scope:this}}},{xtype:"button",id:this.ident+"-filter-clear",cls:"x-form-filter-clear",text:_("babel.reset"),listeners:{click:{fn:this.clearFilter,scope:this}}}]}),Babel.grid.ResourceMatrix.superclass.constructor.call(this,e)},Ext.extend(Babel.grid.ResourceMatrix,MODx.grid.Grid,{linkTranslation:function(e,t){Babel.linkTranslation(e,t,this)},unlinkTranslation:function(e,t){return Babel.unlinkTranslation(e,t,this)},deleteTranslation:function(e,t){return Babel.deleteTranslation(e,t,this)},createTranslation:function(e,t){Babel.createTranslation(e,t)},refreshTranslation:function(e,t){Babel.refreshTranslation(e,t)},clearFilter:function(){var e=this.getStore();e.baseParams.context="",e.baseParams.query="",Ext.getCmp(this.ident+"-filter-context").reset(),Ext.getCmp(this.ident+"-filter-query").reset(),this.getBottomToolbar().changePage(1),this.refresh()},filterByContext:function(e,t){this.getStore().baseParams.context=t.data.key,this.getBottomToolbar().changePage(1),this.refresh()},filterByQuery:function(e,t){return this.getStore().baseParams.query=t,this.getBottomToolbar().changePage(1),this.refresh(),!0},buttonColumnAllRenderer:function(){return this.buttonColumnTpl.apply({action_buttons:[{className:"create-multiple",icon:"plus-square",text:_("babel.create_multiple_translations")},{className:"refresh-multiple",icon:"refresh",text:_("babel.refresh_multiple_translations")},{className:"unlink-all",icon:"chain-broken",text:_("babel.unlink_all")},{className:"delete-all",icon:"trash",text:_("babel.delete_all")}]})},buttonColumnContextRenderer:function(e,t,i){var s,n,o=[];return t.id!=="linkedres_id_"+i.get("context_key")&&(s=t.id.substr("linkedres_id_".length),"x"!==(n=i.get("linkedres_id_"+s)))&&(""===i.get(t.id)?o.push({className:"create",icon:"plus-circle",text:_("babel.create_translation"),ctx:s},{className:"link",icon:"link",text:_("babel.link_translation"),ctx:s}):(t=i.get("linkedres_pagetitle_"+s),o.push({className:"update",icon:"pencil-square-o",text:_("edit")+": "+t+" ("+n+")",ctx:s,target:n},{className:"refresh",icon:"refresh",text:_("babel.refresh")+": "+t+" ("+n+")",ctx:s,target:n},{className:"unlink",icon:"chain-broken",text:_("babel.unlink")+": "+t+" ("+n+")",ctx:s},{className:"delete",icon:"trash-o",text:_("babel.delete")+": "+t+" ("+n+")",ctx:s}))),this.buttonColumnTpl.apply({action_buttons:o})},onClick:function(e){var t=e.getTarget();if("icon"===t.className.split(" ")[0]){var e=t.className.split(" ")[1],i=this.getSelectionModel().getSelected();switch(e){case"create":this.createTranslation(t.dataset.ctx,i.get("id"));break;case"create-multiple":this.createTranslation("",i.get("id"));break;case"link":this.linkTranslation(t.dataset.ctx,i.get("id"));break;case"update":MODx.loadPage("resource/update","id="+t.dataset.target);break;case"refresh":this.refreshTranslation(t.dataset.ctx,i.get("id"));break;case"refresh-multiple":this.refreshTranslation("",i.get("id"));break;case"unlink":this.unlinkTranslation(t.dataset.ctx,i.get("id"));break;case"unlink-all":this.unlinkTranslation("",i.get("id"),0);break;case"delete":this.deleteTranslation(t.dataset.ctx,i.get("id"));break;case"delete-all":this.deleteTranslation("",i.get("id"),0)}}}}),Ext.reg("babel-grid-resourcematrix",Babel.grid.ResourceMatrix),Babel.panel.Home=function(e){e=e||{},Ext.applyIf(e,{cls:"container home-panel"+(Babel.config.debug?" debug":"")+" modx"+Babel.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("babel")+"</h2>"+(Babel.config.debug?'<div class="ribbon top-right"><span>'+_("babel.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,cls:"babel-panel",items:[{xtype:"babel-panel-overview"},{xtype:"hidden",value:0,id:"modx-resource-parent-hidden"}]}]}),Babel.panel.Home.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Home,MODx.Panel),Ext.reg("babel-panel-home",Babel.panel.Home),Babel.panel.HomeTab=function(e){e=e||{},Ext.applyIf(e,{id:"babel-panel-"+e.tabtype,title:e.title,items:[{html:"<p>"+e.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"babel-panel-"+e.tabtype+"-"+e.contenttype,xtype:"babel-"+e.contenttype+"-"+e.tabtype,preventRender:!0,contexts:Babel.config.contexts,listeners:{afterrender:function(){this.store.on("load",function(){var e=this.getTopToolbar().getHeight(),t=this.getView().lockedHd.getHeight(),i=this.getView().lockedBody.getHeight(),s=this.getView().lockedScroller.getHeight(),n=this.getBottomToolbar().getHeight(),o=this.getView().lockedBody.getWidth(),l=this.getView().mainBody.getWidth(),a=this.getEl().getWidth();this.setHeight(e+t+(i=a<o+l?s:i)+n+14)},this)}}}]}]}),Babel.panel.HomeTab.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.HomeTab,MODx.Panel),Ext.reg("babel-panel-hometab",Babel.panel.HomeTab),Babel.panel.Overview=function(e){e=e||{},this.ident="babel-overview-"+Ext.id(),this.panelOverviewTabs=[{xtype:"babel-panel-hometab",title:_("babel.contexts"),description:"<div>"+_("babel.contexts_desc")+'</div><div><i class="icon-babel-description-img icon icon-link"></i>'+_("babel.contexts_desc_link")+'<i class="icon-babel-description-img icon icon-chain-broken"></i>'+_("babel.contexts_desc_unlink")+'<i class="icon-babel-description-img icon icon-pencil-square-o"></i>'+_("babel.contexts_desc_update")+'<i class="icon-babel-description-img icon icon-plus-circle"></i>'+_("babel.contexts_desc_create")+'<i class="icon-babel-description-img icon icon-plus-square"></i>'+_("babel.contexts_desc_create_multiple")+'<i class="icon-babel-description-img icon icon-refresh"></i>'+_("babel.contexts_desc_refresh")+'<i class="icon-babel-description-img icon icon-trash-o"></i>'+_("babel.contexts_desc_delete")+'<i class="icon-babel-description-img icon icon-trash"></i>'+_("babel.contexts_desc_delete_all")+"</div>",tabtype:"resourcematrix",contenttype:"grid"}],(Babel.config.permissions.babel_settings||Babel.config.permissions.settings)&&this.panelOverviewTabs.push({xtype:"babel-panel-settings"}),Ext.applyIf(e,{id:this.ident,items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"babel-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!0,forceLayout:!1,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(e,t){"babel-panel-settings"===t.xtype?Ext.getCmp("babel-grid-system-settings")&&Ext.getCmp("babel-grid-system-settings").getStore().reload():"babel-panel-hometab"===t.xtype&&Ext.getCmp("babel-panel-"+t.tabtype+"-"+t.contenttype)&&Ext.getCmp("babel-panel-"+t.tabtype+"-"+t.contenttype).getStore().reload()}}}]}),Babel.panel.Overview.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Overview,MODx.Panel),Ext.reg("babel-panel-overview",Babel.panel.Overview),MODx.grid.SettingsGrid&&(Babel.panel.Settings=function(e){e=e||{},MODx.request.ns="babel",Ext.applyIf(e,{id:"babel-panel-settings",title:_("babel.settings"),items:[{html:"<p>"+_("babel.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"babel-grid-system-settings",id:"babel-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),Babel.panel.Settings.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Settings,MODx.Panel),Ext.reg("babel-panel-settings",Babel.panel.Settings),Babel.grid.SystemSettings=function(e){e=e||{},Ext.applyIf(e,{id:"babel-grid-systemsettings",url:Babel.config.connectorUrl,baseParams:{action:"mgr/settings/getlist",area:MODx.request.area||""},save_action:"mgr/settings/updatefromgrid",tbar:[],queryParam:3<=Babel.config.modxversion?"query":"key"}),Babel.grid.SystemSettings.superclass.constructor.call(this,e)},Ext.extend(Babel.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(e,t,i){i.stopEvent(),i.preventDefault(),this.menu.record=this.getStore().getAt(t).data,this.getSelectionModel().isSelected(t)||this.getSelectionModel().selectRow(t),this.menu.removeAll();t=[];this.menu.record.menu?t=this.menu.record.menu:t.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<t.length&&(this.addContextMenuItem(t),this.menu.showAt(i.xy))},updateSetting:function(){var e=this.menu.record,t=(e.fk=Ext.isDefined(this.config.fk)?this.config.fk:0,MODx.load({xtype:"modx-window-setting-update",url:Babel.config.connectorUrl,action:"mgr/settings/update",record:e,grid:this,listeners:{success:{fn:this.refresh,scope:this}}}));t.reset(),t.setValues(e),t.show()},clearFilter:function(){var e=MODx.request.area||"",t=(this.getStore().baseParams=this.initialConfig.baseParams,Ext.getCmp("modx-filter-area")),t=((t=t||this.topToolbar.getComponent("filter-area"))&&(t.store.load(),t.reset()),Ext.getCmp("modx-filter-"+this.config.queryParam));(t=t||this.topToolbar.getComponent("filter-query"))&&t.reset(),this.getStore().baseParams.area=e,this.getStore().baseParams[this.config.queryParam]="",this.getBottomToolbar().changePage(1)},filterByKey:function(e,t){return this.getStore().baseParams[this.config.queryParam]=t,this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var e,t=Ext.getCmp("modx-filter-area");(t=t||this.topToolbar.getComponent("filter-area"))&&((e=t.store).removeAll(),e.load(),t.setValue(""))},listeners:{afterrender:function(e){var t=Ext.getCmp("modx-filter-namespace");(t=t||e.topToolbar.getComponent("filter-ns"))&&t.hide()}}}),Ext.reg("babel-grid-system-settings",Babel.grid.SystemSettings)),MODx.config.help_url="https://mikrobi.github.io/babel/usage/",Babel.page.Home=function(e){e=e||{},Ext.applyIf(e,{buttons:[{text:_("babel.about"),handler:Babel.aboutWindow},{text:_("help_ex"),handler:MODx.loadHelpPane}],formpanel:"babel-panel-home",components:[{xtype:"babel-panel-home"}]}),Babel.page.Home.superclass.constructor.call(this,e)},Ext.extend(Babel.page.Home,MODx.Component),Ext.reg("babel-page-home",Babel.page.Home);