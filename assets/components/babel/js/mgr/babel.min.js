/*!
 * Babel - The easy way for your multilingual site!
 * Version: 3.2.0
 * Build date: 2024-02-07
 */
var babel=function(e){babel.superclass.constructor.call(this,e=e||{})},Babel=(Ext.extend(babel,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},getMenu:function(t){var i=this,e=Ext.getCmp("modx-action-buttons");if(e){var s,o=[],l=0;for(s in t)s!==this.config.context_key&&(void 0!==t[s].resourceUrl&&""!==t[s].resourceUrl&&"#"!==t[s].resourceUrl?(o.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-globe"></i>'+t[s].displayText,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-pencil-square-o"></i>'+_("babel.open")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",resourceUrl:t[s].resourceUrl,resourceId:t[s].resourceId,handler:function(){MODx.loadPage("resource/update","id="+this.resourceId)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-chain-broken"></i>'+_("babel.unlink")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",contextKey:s,target:t[s].resourceId,handler:function(){i.unlinkTranslation(this.contextKey,this.target)}}]}}),l++):o.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-globe"></i>'+t[s].displayText,handler:Ext.emptyFn,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-plus-circle"></i>'+_("babel.create_translation"),contextKey:s,handler:function(){i.createTranslation(this.contextKey)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-link"></i>'+_("babel.link_translation"),contextKey:s,handler:function(){i.linkTranslation(this.contextKey)}}]}}));0<l&&(o.push("-"),o.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-chain-broken"></i>'+_("babel.unlink_all_translations"),handler:function(){i.unlinkTranslation()}})),o.push("-"),o.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-lightbulb-o"></i>'+_("babel.about"),handler:function(){i.aboutWindow()}});var n=Ext.getCmp("babel-language-select");n&&n.destroy(),n=new Ext.Button({id:"babel-language-select",text:"Select Language",menu:o,listeners:{render:{fn:function(e){e.setText(t[i.config.context_key].displayText)},scope:this},mouseover:function(e){e.showMenu()}}}),e.insertButton(0,[n]),e.doLayout()}},linkTranslation:function(i){var e=MODx.request.id,s=MODx.load({xtype:"modx-window",title:_("babel.link_translation"),url:this.config.connectorUrl,baseParams:{action:"mgr/resource/link",context:i,id:e},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.getMenu(e.a.result.object.menu),this.hideMask()},scope:this},failure:{fn:this.hideMask,scope:this},beforeSubmit:{fn:this.loadMask,scope:this}},fields:[{xtype:"textfield",fieldLabel:_("context"),anchor:"100%",disabled:!0,emptyText:i},{xtype:"modx-field-parent-change",fieldLabel:_("babel.select_tree_node"),id:"",name:"target-combo",anchor:"100%",end:function(e){var t=Ext.getCmp("modx-resource-tree");t&&(e.display=e.display||e.value,e.context===i)&&(t.removeListener("click",this.handleChangeParent,this),t.on("click",t._handleClick,t),t.disableHref=!1,s.fp.getForm().findField("target").setValue(e.value),s.fp.getForm().findField("page_id").setValue(null),this.setValue(e.display),this.oldValue=!1)},handleChangeParent:function(e,t){var i=Ext.getCmp("modx-resource-tree");return!!i&&(i.disableHref=!0,(i=e.id.split("_")[1])===this.config.currentid?(MODx.msg.alert("",_("resource_err_own_parent")),!1):(this.fireEvent("end",{value:"modContext"!==e.attributes.type?i:e.attributes.pk,display:Ext.util.Format.stripTags(e.text),context:e.attributes.ctx}),t.preventDefault(),t.stopEvent(),!0))}},{xtype:"modx-combo",fieldLabel:_("babel.target_pagetitle"),name:"page_id",anchor:"100%",url:this.config.connectorUrl,baseParams:{action:"mgr/resource/getlist",context:i,combo:!0},displayField:"pagetitle",valueField:"id",fields:["id","pagetitle"],editable:!0,typeAhead:!0,forceSelection:!0,listeners:{select:{fn:function(e,t){var i=e.getValue();""===i||0===i||"&nbsp;"===i?e.setValue(null):s.fp.getForm().findField("target").setValue(t.get("id")),s.fp.getForm().findField("target-combo").reset()},scope:this},blur:{fn:function(e){var t=e.getValue();""!==t&&0!==t&&"&nbsp;"!==t||e.setValue(null)},scope:this}}},{fieldLabel:_("babel.target_id"),xtype:"numberfield",name:"target",anchor:"100%",enableKeyEvents:!0,listeners:{keyup:{fn:function(){s.fp.getForm().findField("target-combo").reset(),s.fp.getForm().findField("page_id").reset()},scope:this}}},{xtype:"xcheckbox",boxLabel:_("babel.copy_tv_values"),name:"copy-tv-values"},{xtype:"xcheckbox",boxLabel:_("babel.sync_linked_tranlations"),name:"sync-linked-tranlations",checked:!0}]});s.show()},unlinkTranslation:function(e,t){this.loadMask(),e=e||"",t=parseInt(t)||0;var i=MODx.request.id,s=0===t?_("babel.unlink_all_translations_confirm"):_("babel.unlink_translation_confirm",{context:e,id:i});return MODx.msg.confirm({title:_("confirm"),text:s,url:this.config.connectorUrl,params:{action:"mgr/resource/unlink",id:i,context:e,target:t},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.getMenu(e.object.menu),this.hideMask()},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},createTranslation:function(e){this.loadMask();var t=MODx.request.id;return MODx.msg.confirm({title:_("confirm"),text:_("babel.create_translation_confirm",{context:e,id:t}),url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",context_key:e,id:t},listeners:{success:{fn:function(e){this.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},loadMask:function(){var e;this.overlayMask||(e=Ext.getBody().dom,this.overlayMask=new Ext.LoadMask(e,{msg:_("babel.please_wait")})),this.overlayMask.show()},hideMask:function(){this.overlayMask&&this.overlayMask.hide()},aboutWindow:function(){Ext.Msg.show({title:_("babel")+" "+Babel.config.version,msg:'&copy; 2010-2024 by Jakob Class<br><br>Authors: <a href="https://github.com/mikrobi">Jakob Class</a>, <a href="https://github.com/goldsky">Rico Goldsky</a>, <a href="https://github.com/JoshuaLuckers">Joshua Luckers</a>, <a href="https://github.com/Jako">Thomas Jakobi</a><br><br>Repository: <a href="https://github.com/Jako/Babel">github.com/Jako/Babel</a>',buttons:Ext.Msg.OK,cls:"babel_window",width:358})}}),Ext.reg("babel",babel),new babel);Babel.combo.Context=function(e){e=e||{},Ext.applyIf(e,{url:Babel.config.connectorUrl,baseParams:{action:"mgr/context/getlist",combo:!0,exclude:"mgr"},tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name:htmlEncode}</span> <tpl if="key"><span style="font-style: italic; font-size: small;">({key:htmlEncode})</span></tpl></div></tpl>')}),Babel.combo.Context.superclass.constructor.call(this,e)},Ext.extend(Babel.combo.Context,MODx.combo.Context,{setValue:function(e){Babel.combo.Context.superclass.setValue.call(this,e=""===e?null:e)}}),Ext.reg("babel-combo-context",Babel.combo.Context),Ext.ns("Ext.ux.grid"),Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:!1,initTemplates:function(){var e=this.templates||{};e.masterTpl||(e.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")),this.templates=e,Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(e){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),t=e.child("div.x-grid3-locked"),i=t.child("div.x-grid3-header"),s=t.child("div.x-grid3-scroller"),o=e.child("div.x-grid3-viewport"),l=o.child("div.x-grid3-header"),n=o.child("div.x-grid3-scroller");this.grid.hideHeaders&&(i.setDisplayed(!1),l.setDisplayed(!1)),this.forceFit&&n.setStyle("overflow-x","hidden"),Ext.apply(this,{el:e,mainWrap:o,mainHd:l,innerHd:l.dom.firstChild,scroller:n,mainBody:n.child("div.x-grid3-body"),focusEl:n.child("a"),resizeMarker:e.child("div.x-grid3-resize-marker"),resizeProxy:e.child("div.x-grid3-resize-proxy"),lockedWrap:t,lockedHd:i,lockedScroller:s,lockedBody:s.child("div.x-grid3-body"),lockedInnerHd:i.child("div.x-grid3-header-inner",!0)}),this.focusEl.swallowEvent("click",!0)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(e){return this.getLockedRows()[e]},getCell:function(e,t){var i=this.cm.getLockedCount();return t<i?this.getLockedRow(e).getElementsByTagName("td")[t]:Ext.ux.grid.LockingGridView.superclass.getCell.call(this,e,t-i)},getHeaderCell:function(e){var t=this.cm.getLockedCount();return e<t?this.lockedHd.dom.getElementsByTagName("td")[e]:Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,e-t)},addRowClass:function(e,t){var i=this.getLockedRow(e);i&&this.fly(i).addClass(t),Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,e,t)},removeRowClass:function(e,t){var i=this.getLockedRow(e);i&&this.fly(i).removeClass(t),Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,e,t)},removeRow:function(e){Ext.removeNode(this.getLockedRow(e)),Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,e)},removeRows:function(e,t){for(var i=this.lockedBody.dom,s=e;s<=t;s++)Ext.removeNode(i.childNodes[e]);Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,e,t)},syncScroll:function(e){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop,Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,e)},updateSortIcon:function(e,t){var i=this.sortClasses,s=this.lockedHd.select("td").removeClass(i),o=this.mainHd.select("td").removeClass(i),l=this.cm.getLockedCount(),i=i["DESC"==t?1:0];(e<l?s.item(e):o.item(e-l)).addClass(i)},updateAllColumnWidths:function(){var e=this.getTotalWidth(),t=this.cm.getColumnCount(),i=this.getLockedWidth(),s=this.cm.getLockedCount(),o=[];for(this.updateLockedWidth(),c=0;c<t;c++)o[c]=this.getColumnWidth(c),this.getHeaderCell(c).style.width=o[c];for(var l,n,a,r=this.getLockedRows(),d=this.getRows(),c=0,h=d.length;c<h;c++){if((l=r[c]).style.width=i,l.firstChild)for(l.firstChild.style.width=i,n=l.firstChild.rows[0],a=0;a<s;a++)n.childNodes[a].style.width=o[a];if((l=d[c]).style.width=e,l.firstChild)for(l.firstChild.style.width=e,n=l.firstChild.rows[0],a=s;a<t;a++)n.childNodes[a-s].style.width=o[a]}this.onAllColumnWidthsUpdated(o,e),this.syncHeaderHeight()},updateColumnWidth:function(e,t){var i,s,o,l,n=this.getColumnWidth(e),a=this.cm.getLockedCount();this.updateLockedWidth(),o=e<a?(i=this.getLockedRows(),s=this.getLockedWidth(),e):(i=this.getRows(),s=this.getTotalWidth(),e-a),this.getHeaderCell(e).style.width=n;for(var r=0,d=i.length;r<d;r++)(l=i[r]).style.width=s,l.firstChild&&(l.firstChild.style.width=s,l.firstChild.rows[0].childNodes[o].style.width=n);this.onColumnWidthUpdated(e,n,this.getTotalWidth()),this.syncHeaderHeight()},updateColumnHidden:function(e,t){var i,s,o,l,n=this.cm.getLockedCount(),a=t?"none":"";this.updateLockedWidth(),o=e<n?(i=this.getLockedRows(),s=this.getLockedWidth(),e):(i=this.getRows(),s=this.getTotalWidth(),e-n),this.getHeaderCell(e).style.display=a;for(var r=0,d=i.length;r<d;r++)(l=i[r]).style.width=s,l.firstChild&&(l.firstChild.style.width=s,l.firstChild.rows[0].childNodes[o].style.display=a);this.onColumnHiddenUpdated(e,t,this.getTotalWidth()),delete this.lastViewWidth,this.layout()},doRender:function(e,t,i,s,o,l){for(var n,a=this.templates,r=a.cell,d=a.row,c=o-1,h="width:"+this.getTotalWidth()+";",u="width:"+this.getLockedWidth()+";",g=[],m=[],p={},x={},b=0,f=t.length;b<f;b++){for(var y=t[b],k=[],v=[],w=b+s,C=0;C<o;C++)n=e[C],p.id=n.id,p.css=(0===C?"x-grid3-cell-first ":C==c?"x-grid3-cell-last ":"")+(this.cm.config[C].cellCls?" "+this.cm.config[C].cellCls:""),p.attr=p.cellAttr="",p.value=n.renderer(y.data[n.name],p,y,w,C,i),p.style=n.style,Ext.isEmpty(p.value)&&(p.value="&#160;"),this.markDirty&&y.dirty&&Ext.isDefined(y.modified[n.name])&&(p.css+=" x-grid3-dirty-cell"),n.locked?v[v.length]=r.apply(p):k[k.length]=r.apply(p);var E=[];l&&(w+1)%2==0&&(E[0]="x-grid3-row-alt"),y.dirty&&(E[1]=" x-grid3-dirty-row"),x.cols=o,this.getRowClass&&(E[2]=this.getRowClass(y,w,x,i)),x.alt=E.join(" "),x.cells=k.join(""),x.tstyle=h,g[g.length]=d.apply(x),x.cells=v.join(""),x.tstyle=u,m[m.length]=d.apply(x)}return[g.join(""),m.join("")]},processRows:function(e,t){if(this.ds&&!(this.ds.getCount()<1)){var i,s,o=this.getRows(),l=this.getLockedRows();t=t||!this.grid.stripeRows,e=e||0;for(var n=0,a=o.length;n<a;++n)i=o[n],s=l[n],i.rowIndex=n,s.rowIndex=n,t||(i.className=i.className.replace(this.rowClsRe," "),s.className=s.className.replace(this.rowClsRe," "),(n+1)%2==0&&(i.className+=" x-grid3-row-alt",s.className+=" x-grid3-row-alt")),this.syncRowHeights(i,s);0===e&&(Ext.fly(o[0]).addClass(this.firstRowCls),Ext.fly(l[0]).addClass(this.firstRowCls)),Ext.fly(o[o.length-1]).addClass(this.lastRowCls),Ext.fly(l[l.length-1]).addClass(this.lastRowCls)}},syncRowHeights:function(e,t){var i,s;this.syncHeights&&(e=Ext.get(e),t=Ext.get(t),i=e.getHeight(),(s=t.getHeight())<i?t.setHeight(i):i<s&&e.setHeight(s))},afterRender:function(){var e;this.ds&&this.cm&&(e=this.renderRows()||["&#160;","&#160;"],this.mainBody.dom.innerHTML=e[0],this.lockedBody.dom.innerHTML=e[1],this.processRows(0,!0),!0!==this.deferEmptyText&&this.applyEmptyText(),this.grid.fireEvent("viewready",this.grid))},renderUI:function(){var e=this.templates,t=this.renderHeaders(),i=e.body.apply({rows:"&#160;"});return e.masterTpl.apply({body:i,header:t[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:i,lockedHeader:t[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var e=this.grid;this.initElements(),Ext.fly(this.innerHd).on("click",this.handleHdDown,this),Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this),this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.scroller.on("scroll",this.syncScroll,this),!1!==e.enableColumnResize&&(this.splitZone=new Ext.grid.GridView.SplitDragZone(e,this.mainHd.dom),this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom)),this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))),e.enableColumnMove&&(this.columnDrag=new Ext.grid.GridView.ColumnDragZone(e,this.innerHd),this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd)),this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd)),this.columnDrop=new Ext.grid.HeaderDropZone(e,this.mainHd.dom)),!1!==e.enableHdMenu&&(this.hmenu=new Ext.menu.Menu({id:e.id+"-hctx"}),this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),!1!==this.grid.enableColLock&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"}),!1!==e.enableColumnHide&&(this.colMenu=new Ext.menu.Menu({id:e.id+"-hcols-menu"}),this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick}),this.hmenu.add("-",{itemId:"columns",hideOnClick:!1,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})),this.hmenu.on("itemclick",this.handleHdMenuClick,this)),e.trackMouseOver&&(this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut}),this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})),(e.enableDragDrop||e.enableDrag)&&(this.dragZone=new Ext.grid.GridDragZone(e,{ddGroup:e.ddGroup||"GridDD"})),this.updateHeaderSortState()},layout:function(){var e,t,i,s;this.mainBody&&(t=(e=(i=this.grid).getGridEl().getSize(!0)).width,!i.hideHeaders&&(t<20||e.height<20)||(this.syncHeaderHeight(),i.autoHeight?(this.scroller.dom.style.overflow="visible",this.lockedScroller.dom.style.overflow="visible",Ext.isWebKit&&(this.scroller.dom.style.position="static",this.lockedScroller.dom.style.position="static")):(this.el.setSize(e.width,e.height),i=this.mainHd.getHeight(),s=e.height-i),this.updateLockedWidth(),this.forceFit?this.lastViewWidth!=t&&(this.fitColumns(!1,!1),this.lastViewWidth=t):(this.autoExpand(),this.syncHeaderScroll()),this.onLayout(t,s)))},getOffsetWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){for(var e=this.cm,t=this.templates,i=t.hcell,s=[],o=[],l={},n=e.getColumnCount(),a=n-1,r=0;r<n;r++)l.id=e.getColumnId(r),l.value=e.getColumnHeader(r)||"",l.style=this.getColumnStyle(r,!0),l.tooltip=this.getColumnTooltip(r),l.css=(0===r?"x-grid3-cell-first ":r==a?"x-grid3-cell-last ":"")+(e.config[r].headerCls?" "+e.config[r].headerCls:""),"right"==e.config[r].align?l.istyle="padding-right:16px":delete l.istyle,e.isLocked(r)?o[o.length]=i.apply(l):s[s.length]=i.apply(l);return[t.header.apply({cells:s.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),t.header.apply({cells:o.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var e=this.renderHeaders(),e=(this.innerHd.firstChild.innerHTML=e[0],this.innerHd.firstChild.style.width=this.getOffsetWidth(),this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth(),this.lockedInnerHd.firstChild.innerHTML=e[1],this.getLockedWidth());this.lockedInnerHd.firstChild.style.width=e,this.lockedInnerHd.firstChild.firstChild.style.width=e},getResolvedXY:function(e){var t;return e?(t=e.cell,e=e.row,t?Ext.fly(t).getXY():[this.scroller.getX(),Ext.fly(e).getY()]):null},syncFocusEl:function(e,t,i){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,e,t,!(t<this.cm.getLockedCount())&&i)},ensureVisible:function(e,t,i){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,e,t,!(t<this.cm.getLockedCount())&&i)},insertRows:function(e,t,i,s){var o,l,e=e.getCount()-1;!s&&0===t&&e<=i?this.refresh():(s||this.fireEvent("beforerowsinserted",this,t,i),o=this.renderRows(t,i),(l=this.getRow(t))?(0===t&&this.removeRowClass(0,this.firstRowCls),Ext.DomHelper.insertHtml("beforeBegin",l,o[0]),l=this.getLockedRow(t),Ext.DomHelper.insertHtml("beforeBegin",l,o[1])):(this.removeRowClass(e-1,this.lastRowCls),Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,o[0]),Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,o[1])),s?(0===t||e<=t)&&this.addRowClass(t,0===t?this.firstRowCls:this.lastRowCls):(this.fireEvent("rowsinserted",this,t,i),this.processRows(t))),this.syncFocusEl(t)},getColumnStyle:function(e,t){t=t?this.cm.config[e].headerStyle||"":this.cm.config[e].cellStyle||this.cm.config[e].css||"",t+="width:"+this.getColumnWidth(e)+";",this.cm.isHidden(e)&&(t+="display:none;"),e=this.cm.config[e].align;return e&&(t+="text-align:"+e+";"),t},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var e=[],t=this.cm,i=t.getColumnCount(),s=0;s<i;s++){var o=t.getDataIndex(s);e[s]={name:Ext.isDefined(o)?o:this.ds.fields.get(s).name,renderer:t.getRenderer(s),scope:t.getRendererScope(s),id:t.getColumnId(s),style:this.getColumnStyle(s),locked:t.isLocked(s)}}return e},renderBody:function(){var e=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:e[0]}),this.templates.body.apply({rows:e[1]})]},refreshRow:function(e){var t,i,s,o,l,n,a=this.ds,r=this.cm.getColumnCount(),d=this.getColumnData(),c=r-1,h=["x-grid3-row"],u={tstyle:String.format("width: {0};",this.getTotalWidth())},g={tstyle:String.format("width: {0};",this.getLockedWidth())},m=[],p=[],x=this.templates.cell;if(Ext.isNumber(e)?(t=e,e=a.getAt(t)):t=a.indexOf(e),e&&!(t<0)){for(n=0;n<r;n++)(l={id:(o=d[n]).id,style:o.style,css:0==n?"x-grid3-cell-first":n==c?"x-grid3-cell-last ":"",attr:"",cellAttr:""}).value=o.renderer.call(o.scope,e.data[o.name],l,e,t,n,a),Ext.isEmpty(l.value)&&(l.value=" "),this.markDirty&&e.dirty&&void 0!==e.modified[o.name]&&(l.css+=" x-grid3-dirty-cell"),o.locked?p[n]=x.apply(l):m[n]=x.apply(l);(i=this.getRow(t)).className="",(s=this.getLockedRow(t)).className="",this.grid.stripeRows&&(t+1)%2==0&&h.push("x-grid3-row-alt"),this.getRowClass&&(u.cols=r,h.push(this.getRowClass(e,t,u,a))),this.fly(i).addClass(h).setStyle(u.tstyle),u.cells=m.join(""),i.innerHTML=this.templates.rowInner.apply(u),this.fly(s).addClass(h).setStyle(g.tstyle),g.cells=p.join(""),s.innerHTML=this.templates.rowInner.apply(g),s.rowIndex=t,this.syncRowHeights(i,s),this.fireEvent("rowupdated",this,t,e)}},refresh:function(e){this.fireEvent("beforerefresh",this),this.grid.stopEditing(!0);var t=this.renderBody();this.mainBody.update(t[0]).setWidth(this.getTotalWidth()),this.lockedBody.update(t[1]).setWidth(this.getLockedWidth()),!0===e&&(this.updateHeaders(),this.updateHeaderSortState()),this.processRows(0,!0),this.layout(),this.applyEmptyText(),this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(e,t){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this),Ext.ux.grid.LockingGridView.superclass.initData.call(this,e,t),this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(!0)},handleHdMenuClick:function(e){var t=this.hdCtxIndex,i=this.cm,s=e.getItemId(),o=i.getLockedCount();switch(s){case"lock":if(i.getColumnCount(!0)<=o+1)return void this.onDenyColumnLock();i.setLocked(t,!0,o!=t),o!=t&&(i.moveColumn(t,o),this.grid.fireEvent("columnmove",t,o));break;case"unlock":o-1!=t?(i.setLocked(t,!1,!0),i.moveColumn(t,o-1),this.grid.fireEvent("columnmove",t,o-1)):i.setLocked(t,!1);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,e)}return!0},handleHdDown:function(e,t){var i;Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,e,t),!1!==this.grid.enableColLock&&Ext.fly(t).hasClass("x-grid3-hd-btn")&&(e=this.findHeaderCell(t),t=this.getCellIndex(e),e=this.hmenu.items,i=this.cm,e.get("lock").setDisabled(i.isLocked(t)),e.get("unlock").setDisabled(!i.isLocked(t)))},syncHeaderHeight:function(){var e=Ext.fly(this.innerHd).child("tr",!0),t=Ext.fly(this.lockedInnerHd).child("tr",!0),i=(e.style.height="auto",t.style.height="auto",e.offsetHeight),s=t.offsetHeight,s=Math.max(s,i)+"px";e.style.height=s,t.style.height=s},updateLockedWidth:function(){var e=this.cm.getTotalLockedWidth(),t=this.cm.getTotalWidth()-e,i=this.grid.getGridEl().getSize(!0),s=Ext.isBorderBox?0:this.lockedBorderWidth,o=Ext.isBorderBox?0:this.rowBorderWidth,l=Math.max(i.width-e-s-o,0)+"px",n=this.getScrollOffset();this.grid.autoHeight||(i=Math.max(i.height-this.mainHd.getHeight(),0)+"px",this.lockedScroller.dom.style.height=i,this.scroller.dom.style.height=i),this.lockedWrap.dom.style.width=e+o+"px",this.scroller.dom.style.width=l,this.mainWrap.dom.style.left=e+s+o+"px",this.innerHd&&(this.lockedInnerHd.firstChild.style.width=e+"px",this.lockedInnerHd.firstChild.firstChild.style.width=e+"px",this.innerHd.style.width=l,this.innerHd.firstChild.style.width=t+o+n+"px",this.innerHd.firstChild.firstChild.style.width=t+"px"),this.mainBody&&(this.lockedBody.dom.style.width=e+o+"px",this.mainBody.dom.style.width=t+o+"px")}}),Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(e){return!0===this.config[e].locked},setLocked:function(e,t,i){this.isLocked(e)==t||(this.config[e].locked=t,i)||this.fireEvent("columnlockchange",this,e,t)},getTotalLockedWidth:function(){for(var e=0,t=0,i=this.config.length;t<i;t++)this.isLocked(t)&&!this.isHidden(t)&&(e+=this.getColumnWidth(t));return e},getLockedCount:function(){for(var e=this.config.length,t=0;t<e;t++)if(!this.isLocked(t))return t;return e},moveColumn:function(e,t){var i=this.isLocked(e),s=this.isLocked(t);e<t&&i&&!s?this.setLocked(e,!1,!0):t<e&&!i&&s&&this.setLocked(e,!0,!0),Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}}),Babel.grid.ResourceMatrix=function(e){e=e||{},this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}" data-ctx="{ctx}" data-target="{target}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.ident="babel-resourcematrix-"+Ext.id();var t=this,i=[],s=["id","context_key","pagetitle","parent"],o=[],l=(e.contexts&&(i=[{header:_("id"),width:70,sortable:!0,dataIndex:"id",locked:!0,id:"res_id"},{header:_("context"),width:80,sortable:!0,dataIndex:"context_key",locked:!0,id:"context_key"},{header:_("pagetitle"),width:200,sortable:!0,dataIndex:"pagetitle",locked:!0,id:"pagetitle"},{header:_("babel.all"),renderer:this.buttonColumnAllRenderer.bind(this),menuDisabled:!0,fixed:!0,locked:!0,width:50}],Ext.each(e.contexts,function(e){s.push("linkedres_id_"+e),s.push("linkedres_pagetitle_"+e),o.push(e),i.push({header:e,width:70,sortable:!1,dataIndex:"linkedres_id_"+e,id:"linkedres_id_"+e,menuDisabled:!0,renderer:t.buttonColumnContextRenderer.bind(t)})})),new Ext.ux.grid.LockingColumnModel({columns:i}));new Ext.ux.grid.LockingGridView({syncHeights:!0});Ext.apply(e,{url:Babel.config.connectorUrl,baseParams:{action:"mgr/resource/getmatrixlist",contexts:o.toString()},colModel:l,fields:s,paging:!0,remoteSort:!0,anchor:"100%",view:new Ext.ux.grid.LockingGridView,autoHeight:!1,showActionsColumn:!1,tbar:[{xtype:"babel-combo-context",id:this.ident+"-filter-context",emptyText:_("babel.select_context"),listeners:{select:{fn:this.filterByContext,scope:this}}},"->",{xtype:"textfield",id:this.ident+"-filter-query",cls:"x-form-filter",emptyText:_("babel.search"),width:300,listeners:{change:{fn:this.filterByQuery,scope:this},render:{fn:function(e){new Ext.KeyMap(e.getEl(),{key:Ext.EventObject.ENTER,fn:this.blur,scope:e})},scope:this}}},{xtype:"button",id:this.ident+"-filter-clear",cls:"x-form-filter-clear",text:_("babel.reset"),listeners:{click:{fn:this.clearFilter,scope:this}}}]}),Babel.grid.ResourceMatrix.superclass.constructor.call(this,e)},Ext.extend(Babel.grid.ResourceMatrix,MODx.grid.Grid,{linkTranslation:function(i,e){var s=MODx.load({xtype:"modx-window",title:_("babel.link_translation"),url:Babel.config.connectorUrl,baseParams:{action:"mgr/resource/link",context:i,id:e},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.hideMask(),this.refresh()},scope:this},failure:{fn:this.hideMask,scope:this},beforeSubmit:{fn:this.loadMask,scope:this}},fields:[{xtype:"textfield",fieldLabel:_("context"),anchor:"100%",disabled:!0,emptyText:i},{xtype:"modx-field-parent-change",fieldLabel:_("babel.select_tree_node"),id:"",name:"target-combo",anchor:"100%",end:function(e){var t=Ext.getCmp("modx-resource-tree");t&&(e.display=e.display||e.value,e.context===i)&&(t.removeListener("click",this.handleChangeParent,this),t.on("click",t._handleClick,t),t.disableHref=!1,s.fp.getForm().findField("target").setValue(e.value),s.fp.getForm().findField("page_id").setValue(null),this.setValue(e.display),this.oldValue=!1)},handleChangeParent:function(e,t){var i=Ext.getCmp("modx-resource-tree");return!!i&&(i.disableHref=!0,(i=e.id.split("_")[1])===this.config.currentid?(MODx.msg.alert("",_("resource_err_own_parent")),!1):(this.fireEvent("end",{value:"modContext"!==e.attributes.type?i:e.attributes.pk,display:Ext.util.Format.stripTags(e.text),context:e.attributes.ctx}),t.preventDefault(),t.stopEvent(),!0))}},{xtype:"modx-combo",fieldLabel:_("babel.target_pagetitle"),name:"page_id",anchor:"100%",url:Babel.config.connectorUrl,baseParams:{action:"mgr/resource/getlist",context:i,combo:!0},displayField:"pagetitle",valueField:"id",fields:["id","pagetitle"],editable:!0,typeAhead:!0,forceSelection:!0,listeners:{select:{fn:function(e,t){var i=e.getValue();""===i||0===i||"&nbsp;"===i?e.setValue(null):s.fp.getForm().findField("target").setValue(t.get("id")),s.fp.getForm().findField("target-combo").reset()},scope:this},blur:{fn:function(e){var t=e.getValue();""!==t&&0!==t&&"&nbsp;"!==t||e.setValue(null)},scope:this}}},{fieldLabel:_("babel.target_id"),xtype:"numberfield",name:"target",anchor:"100%",enableKeyEvents:!0,listeners:{keyup:{fn:function(){s.fp.getForm().findField("target-combo").reset(),s.fp.getForm().findField("page_id").reset()},scope:this}}},{xtype:"xcheckbox",boxLabel:_("babel.copy_tv_values"),name:"copy-tv-values"},{xtype:"xcheckbox",boxLabel:_("babel.sync_linked_tranlations"),name:"sync-linked-tranlations",checked:!0}]});s.reset(),s.show()},unlinkTranslation:function(e,t,i){this.loadMask(),e=e||"";var s=0===(i=parseInt(i)||0)?_("babel.unlink_all_translations_confirm"):_("babel.unlink_translation_confirm",{context:e,id:t});return MODx.msg.confirm({title:_("confirm"),text:s,url:Babel.config.connectorUrl,params:{action:"mgr/resource/unlink",id:t,context:e,target:i},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.hideMask(),this.refresh()},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},createTranslation:function(e,t){return this.loadMask(),MODx.msg.confirm({title:_("confirm"),text:_("babel.create_translation_confirm",{context:e,id:t}),url:Babel.config.connectorUrl,params:{action:"mgr/resource/duplicate",context_key:e,id:t},listeners:{success:{fn:function(e){this.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},clearFilter:function(){var e=this.getStore();e.baseParams.context="",e.baseParams.query="",Ext.getCmp(this.ident+"-filter-context").reset(),Ext.getCmp(this.ident+"-filter-query").reset(),this.getBottomToolbar().changePage(1),this.refresh()},filterByContext:function(e,t){this.getStore().baseParams.context=t.data.key,this.getBottomToolbar().changePage(1),this.refresh()},filterByQuery:function(e,t){return this.getStore().baseParams.query=t,this.getBottomToolbar().changePage(1),this.refresh(),!0},loadMask:function(){var e;this.overlayMask||(e=Ext.getBody().dom,this.overlayMask=new Ext.LoadMask(e,{msg:_("babel.please_wait")})),this.overlayMask.show()},hideMask:function(){this.overlayMask&&this.overlayMask.hide()},buttonColumnAllRenderer:function(){return this.buttonColumnTpl.apply({action_buttons:[{className:"unlink-all",icon:"chain-broken",text:_("babel.unlink")}]})},buttonColumnContextRenderer:function(e,t,i){var s,o=[];return t.id!=="linkedres_id_"+i.get("context_key")&&(s=t.id.substr("linkedres_id_".length),""===i.get(t.id)?o.push({className:"create",icon:"plus-circle",text:_("babel.create_translation"),ctx:s,target:0},{className:"link",icon:"link",text:_("babel.link_translation"),ctx:s,target:0}):(t=i.get("linkedres_pagetitle_"+s),i=i.get("linkedres_id_"+s),o.push({className:"update",icon:"pencil-square-o",text:_("edit")+": "+t+" ("+i+")",ctx:s,target:i},{className:"unlink",icon:"chain-broken",text:_("babel.unlink")+": "+t+" ("+i+")",ctx:s,target:i}))),this.buttonColumnTpl.apply({action_buttons:o})},onClick:function(e){var t=e.getTarget();if("icon"===t.className.split(" ")[0]){var e=t.className.split(" ")[1],i=this.getSelectionModel().getSelected();switch(e){case"unlink-all":this.unlinkTranslation("",i.get("id"),0);break;case"create":this.createTranslation(t.dataset.ctx,i.get("id"));break;case"link":this.linkTranslation(t.dataset.ctx,i.get("id"));break;case"update":MODx.loadPage("resource/update","id="+t.dataset.target),console.log(i);break;case"unlink":this.unlinkTranslation(t.dataset.ctx,i.get("id"),t.dataset.target)}}}}),Ext.reg("babel-grid-resourcematrix",Babel.grid.ResourceMatrix),Babel.panel.Home=function(e){e=e||{},Ext.applyIf(e,{cls:"container home-panel"+(Babel.config.debug?" debug":"")+" modx"+Babel.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("babel")+"</h2>"+(Babel.config.debug?'<div class="ribbon top-right"><span>'+_("babel.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,cls:"babel-panel",items:[{xtype:"babel-panel-overview"}]}]}),Babel.panel.Home.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Home,MODx.Panel),Ext.reg("babel-panel-home",Babel.panel.Home),Babel.panel.HomeTab=function(e){e=e||{},Ext.applyIf(e,{id:"babel-panel-"+e.tabtype,title:e.title,items:[{html:"<p>"+e.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"babel-panel-"+e.tabtype+"-"+e.contenttype,xtype:"babel-"+e.contenttype+"-"+e.tabtype,preventRender:!0,contexts:Babel.config.contexts,listeners:{afterrender:function(){this.store.on("load",function(){var e=this.getTopToolbar().getHeight(),t=this.getView().lockedHd.getHeight(),i=this.getView().lockedBody.getHeight(),s=this.getBottomToolbar().getHeight();this.setHeight(e+t+i+s+14)},this)}}}]}]}),Babel.panel.HomeTab.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.HomeTab,MODx.Panel),Ext.reg("babel-panel-hometab",Babel.panel.HomeTab),Babel.panel.Overview=function(e){e=e||{},this.ident="babel-overview-"+Ext.id(),this.panelOverviewTabs=[{xtype:"babel-panel-hometab",title:_("babel.contexts"),description:"<div>"+_("babel.contexts_desc")+'</div><div><i class="icon-babel-description-img icon icon-link"></i>'+_("babel.contexts_desc_link")+'<i class="icon-babel-description-img icon icon-chain-broken"></i>'+_("babel.contexts_desc_unlink")+'<i class="icon-babel-description-img icon icon-pencil-square-o"></i>'+_("babel.contexts_desc_update")+'<i class="icon-babel-description-img icon icon-plus-circle"></i>'+_("babel.contexts_desc_create")+"</div>",tabtype:"resourcematrix",contenttype:"grid"}],(Babel.config.permissions.babel_settings||Babel.config.permissions.settings)&&this.panelOverviewTabs.push({xtype:"babel-panel-settings"}),Ext.applyIf(e,{id:this.ident,items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"babel-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!0,forceLayout:!1,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(e,t){"babel-panel-settings"===t.xtype?Ext.getCmp("babel-grid-system-settings")&&Ext.getCmp("babel-grid-system-settings").getStore().reload():"babel-panel-hometab"===t.xtype&&Ext.getCmp("babel-panel-"+t.tabtype+"-"+t.contenttype)&&Ext.getCmp("babel-panel-"+t.tabtype+"-"+t.contenttype).getStore().reload()}}}]}),Babel.panel.Overview.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Overview,MODx.Panel),Ext.reg("babel-panel-overview",Babel.panel.Overview),MODx.grid.SettingsGrid&&(Babel.panel.Settings=function(e){e=e||{},MODx.request.ns="babel",Ext.applyIf(e,{id:"babel-panel-settings",title:_("babel.settings"),items:[{html:"<p>"+_("babel.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"babel-grid-system-settings",id:"babel-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),Babel.panel.Settings.superclass.constructor.call(this,e)},Ext.extend(Babel.panel.Settings,MODx.Panel),Ext.reg("babel-panel-settings",Babel.panel.Settings),Babel.grid.SystemSettings=function(e){e=e||{},Ext.applyIf(e,{id:"babel-grid-systemsettings",url:Babel.config.connectorUrl,baseParams:{action:"mgr/settings/getlist",area:MODx.request.area||""},save_action:"mgr/settings/updatefromgrid",tbar:[],queryParam:3<=Babel.config.modxversion?"query":"key"}),Babel.grid.SystemSettings.superclass.constructor.call(this,e)},Ext.extend(Babel.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(e,t,i){i.stopEvent(),i.preventDefault(),this.menu.record=this.getStore().getAt(t).data,this.getSelectionModel().isSelected(t)||this.getSelectionModel().selectRow(t),this.menu.removeAll();t=[];this.menu.record.menu?t=this.menu.record.menu:t.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<t.length&&(this.addContextMenuItem(t),this.menu.showAt(i.xy))},updateSetting:function(e,t){var i=this.menu.record,s=(i.fk=Ext.isDefined(this.config.fk)?this.config.fk:0,MODx.load({xtype:"modx-window-setting-update",url:Babel.config.connectorUrl,action:"mgr/settings/update",record:i,grid:this,listeners:{success:{fn:this.refresh,scope:this}}}));s.reset(),s.setValues(i),s.show()},clearFilter:function(){var e=MODx.request.area||"",t=(this.getStore().baseParams=this.initialConfig.baseParams,Ext.getCmp("modx-filter-area")),t=((t=t||this.topToolbar.getComponent("filter-area"))&&(t.store.load(),t.reset()),Ext.getCmp("modx-filter-"+this.config.queryParam));(t=t||this.topToolbar.getComponent("filter-query"))&&t.reset(),this.getStore().baseParams.area=e,this.getStore().baseParams[this.config.queryParam]="",this.getBottomToolbar().changePage(1)},filterByKey:function(e,t){return this.getStore().baseParams[this.config.queryParam]=t,this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var e,t=Ext.getCmp("modx-filter-area");(t=t||this.topToolbar.getComponent("filter-area"))&&((e=t.store).removeAll(),e.load(),t.setValue(""))},listeners:{afterrender:function(e){var t=Ext.getCmp("modx-filter-namespace");(t=t||e.topToolbar.getComponent("filter-ns"))&&t.hide()}}}),Ext.reg("babel-grid-system-settings",Babel.grid.SystemSettings)),MODx.config.help_url="https://mikrobi.github.io/babel/usage/",Babel.page.Home=function(e){e=e||{},Ext.applyIf(e,{buttons:[{text:_("babel.about"),handler:Babel.aboutWindow},{text:_("help_ex"),handler:MODx.loadHelpPane}],formpanel:"babel-panel-home",components:[{xtype:"babel-panel-home"}]}),Babel.page.Home.superclass.constructor.call(this,e)},Ext.extend(Babel.page.Home,MODx.Component),Ext.reg("babel-page-home",Babel.page.Home);