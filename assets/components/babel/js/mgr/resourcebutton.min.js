/*!
 * Babel - The easy way for your multilingual site!
 * Version: 3.2.0
 * Build date: 2024-02-07
 */
var babel=function(e){babel.superclass.constructor.call(this,e=e||{})},Babel=(Ext.extend(babel,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},getMenu:function(t){var n=this,e=Ext.getCmp("modx-action-buttons");if(e){var i,s=[],o=0;for(i in t)i!==this.config.context_key&&(void 0!==t[i].resourceUrl&&""!==t[i].resourceUrl&&"#"!==t[i].resourceUrl?(s.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-globe"></i>'+t[i].displayText,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-pencil-square-o"></i>'+_("babel.open")+" <b>"+t[i].resourceTitle+" ("+t[i].resourceId+")</b>",resourceUrl:t[i].resourceUrl,resourceId:t[i].resourceId,handler:function(){MODx.loadPage("resource/update","id="+this.resourceId)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-chain-broken"></i>'+_("babel.unlink")+" <b>"+t[i].resourceTitle+" ("+t[i].resourceId+")</b>",contextKey:i,target:t[i].resourceId,handler:function(){n.unlinkTranslation(this.contextKey,this.target)}}]}}),o++):s.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-globe"></i>'+t[i].displayText,handler:Ext.emptyFn,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-plus-circle"></i>'+_("babel.create_translation"),contextKey:i,handler:function(){n.createTranslation(this.contextKey)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-link"></i>'+_("babel.link_translation"),contextKey:i,handler:function(){n.linkTranslation(this.contextKey)}}]}}));0<o&&(s.push("-"),s.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-chain-broken"></i>'+_("babel.unlink_all_translations"),handler:function(){n.unlinkTranslation()}})),s.push("-"),s.push({text:'<i class="x-menu-item-icon x-buttonmenu-item-icon icon icon-lightbulb-o"></i>'+_("babel.about"),handler:function(){n.aboutWindow()}});var a=Ext.getCmp("babel-language-select");a&&a.destroy(),a=new Ext.Button({id:"babel-language-select",text:"Select Language",menu:s,listeners:{render:{fn:function(e){e.setText(t[n.config.context_key].displayText)},scope:this},mouseover:function(e){e.showMenu()}}}),e.insertButton(0,[a]),e.doLayout()}},linkTranslation:function(n){var e=MODx.request.id,i=MODx.load({xtype:"modx-window",title:_("babel.link_translation"),url:this.config.connectorUrl,baseParams:{action:"mgr/resource/link",context:n,id:e},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.getMenu(e.a.result.object.menu),this.hideMask()},scope:this},failure:{fn:this.hideMask,scope:this},beforeSubmit:{fn:this.loadMask,scope:this}},fields:[{xtype:"textfield",fieldLabel:_("context"),anchor:"100%",disabled:!0,emptyText:n},{xtype:"modx-field-parent-change",fieldLabel:_("babel.select_tree_node"),id:"",name:"target-combo",anchor:"100%",end:function(e){var t=Ext.getCmp("modx-resource-tree");t&&(e.display=e.display||e.value,e.context===n)&&(t.removeListener("click",this.handleChangeParent,this),t.on("click",t._handleClick,t),t.disableHref=!1,i.fp.getForm().findField("target").setValue(e.value),i.fp.getForm().findField("page_id").setValue(null),this.setValue(e.display),this.oldValue=!1)},handleChangeParent:function(e,t){var n=Ext.getCmp("modx-resource-tree");return!!n&&(n.disableHref=!0,(n=e.id.split("_")[1])===this.config.currentid?(MODx.msg.alert("",_("resource_err_own_parent")),!1):(this.fireEvent("end",{value:"modContext"!==e.attributes.type?n:e.attributes.pk,display:Ext.util.Format.stripTags(e.text),context:e.attributes.ctx}),t.preventDefault(),t.stopEvent(),!0))}},{xtype:"modx-combo",fieldLabel:_("babel.target_pagetitle"),name:"page_id",anchor:"100%",url:this.config.connectorUrl,baseParams:{action:"mgr/resource/getlist",context:n,combo:!0},displayField:"pagetitle",valueField:"id",fields:["id","pagetitle"],editable:!0,typeAhead:!0,forceSelection:!0,listeners:{select:{fn:function(e,t){var n=e.getValue();""===n||0===n||"&nbsp;"===n?e.setValue(null):i.fp.getForm().findField("target").setValue(t.get("id")),i.fp.getForm().findField("target-combo").reset()},scope:this},blur:{fn:function(e){var t=e.getValue();""!==t&&0!==t&&"&nbsp;"!==t||e.setValue(null)},scope:this}}},{fieldLabel:_("babel.target_id"),xtype:"numberfield",name:"target",anchor:"100%",enableKeyEvents:!0,listeners:{keyup:{fn:function(){i.fp.getForm().findField("target-combo").reset(),i.fp.getForm().findField("page_id").reset()},scope:this}}},{xtype:"xcheckbox",boxLabel:_("babel.copy_tv_values"),name:"copy-tv-values"},{xtype:"xcheckbox",boxLabel:_("babel.sync_linked_tranlations"),name:"sync-linked-tranlations",checked:!0}]});i.show()},unlinkTranslation:function(e,t){this.loadMask(),e=e||"",t=parseInt(t)||0;var n=MODx.request.id,i=0===t?_("babel.unlink_all_translations_confirm"):_("babel.unlink_translation_confirm",{context:e,id:n});return MODx.msg.confirm({title:_("confirm"),text:i,url:this.config.connectorUrl,params:{action:"mgr/resource/unlink",id:n,context:e,target:t},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),this.getMenu(e.object.menu),this.hideMask()},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},createTranslation:function(e){this.loadMask();var t=MODx.request.id;return MODx.msg.confirm({title:_("confirm"),text:_("babel.create_translation_confirm",{context:e,id:t}),url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",context_key:e,id:t},listeners:{success:{fn:function(e){this.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this},failure:{fn:this.hideMask,scope:this},cancel:{fn:this.hideMask,scope:this}}})},loadMask:function(){var e;this.overlayMask||(e=Ext.getBody().dom,this.overlayMask=new Ext.LoadMask(e,{msg:_("babel.please_wait")})),this.overlayMask.show()},hideMask:function(){this.overlayMask&&this.overlayMask.hide()},aboutWindow:function(){Ext.Msg.show({title:_("babel")+" "+Babel.config.version,msg:'&copy; 2010-2024 by Jakob Class<br><br>Authors: <a href="https://github.com/mikrobi">Jakob Class</a>, <a href="https://github.com/goldsky">Rico Goldsky</a>, <a href="https://github.com/JoshuaLuckers">Joshua Luckers</a>, <a href="https://github.com/Jako">Thomas Jakobi</a><br><br>Repository: <a href="https://github.com/mikrobi/babel">github.com/mikrobi/babel</a>',buttons:Ext.Msg.OK,cls:"babel_window",width:358})}}),Ext.reg("babel",babel),new babel);
