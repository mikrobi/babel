/*!
 * Babel - The easy way for your multilingual site!
 * Version: 3.3.0
 * Build date: 2024-03-27
 */
var babel=function(e){babel.superclass.constructor.call(this,e=e||{})},Babel=(Ext.extend(babel,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},getMenu:function(t){var n=this,e=Ext.getCmp("modx-action-buttons");if(e){var s,o=[],a=0,i=0;for(s in t)s!==this.config.context_key&&(void 0!==t[s].resourceUrl&&""!==t[s].resourceUrl&&"#"!==t[s].resourceUrl?(o.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-globe"></i>'+t[s].displayText,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-pencil-square-o"></i>'+_("babel.open")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",resourceUrl:t[s].resourceUrl,resourceId:t[s].resourceId,handler:function(){MODx.loadPage("resource/update","id="+this.resourceId)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-chain-broken"></i>'+_("babel.unlink")+" <b>"+t[s].resourceTitle+" ("+t[s].resourceId+")</b>",contextKey:s,target:t[s].resourceId,handler:function(){n.unlinkTranslation(this.contextKey,0,this.target)}}]}}),a++):(o.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-globe"></i>'+t[s].displayText,handler:Ext.emptyFn,menu:{items:[{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-plus-circle"></i>'+_("babel.create_translation"),contextKey:s,handler:function(){n.createTranslation(this.contextKey)}},"-",{text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-link"></i>'+_("babel.link_translation"),contextKey:s,handler:function(){n.linkTranslation(this.contextKey)}}]}}),i++));0<a&&(o.push("-"),o.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-chain-broken"></i>'+_("babel.unlink_all_translations"),handler:function(){n.unlinkTranslation()}})),0<i&&(o.push("-"),o.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-plus-square"></i>'+_("babel.create_multiple_translations"),contextKey:s,target:t[s].resourceId,handler:function(){n.createTranslation()}})),o.push("-"),o.push({text:'<i class="x-menu-item-icon x-buttonmenu-babel-item-icon icon icon-lightbulb-o"></i>'+_("babel.about"),handler:function(){n.aboutWindow()}});var c=Ext.getCmp("babel-language-select");c&&c.destroy(),c=new Ext.Button({id:"babel-language-select",text:"Select Language",menu:o,listeners:{render:{fn:function(e){e.setText(t[n.config.context_key].displayText)},scope:this},mouseover:function(e){e.showMenu()}}}),e.insertButton(0,[c]),e.doLayout()}},linkTranslation:function(n,e,t){var s=this,o=(e=e||MODx.request.id,MODx.load({xtype:"modx-window",title:_("babel.link_translation"),closeAction:"close",url:s.config.connectorUrl,baseParams:{action:"mgr/resource/link",context:n,id:e},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),t?t.refresh():s.getMenu(e.a.result.object.menu),s.hideMask()},scope:this},failure:{fn:s.hideMask,scope:this},beforeSubmit:{fn:s.loadMask,scope:this}},fields:[{xtype:"textfield",fieldLabel:_("context"),anchor:"100%",disabled:!0,emptyText:n},{xtype:"modx-field-parent-change",fieldLabel:_("babel.select_tree_node"),id:"",name:"target-combo",anchor:"100%",end:function(e){var t=Ext.getCmp("modx-resource-tree");t&&(e.display=e.display||e.value,e.context===n)&&(t.removeListener("click",this.handleChangeParent,this),t.on("click",t._handleClick,t),t.disableHref=!1,o.fp.getForm().findField("target").setValue(e.value),o.fp.getForm().findField("page_id").setValue(null),this.setValue(e.display),this.oldValue=!1)},handleChangeParent:function(e,t){var n=Ext.getCmp("modx-resource-tree");return!!n&&(n.disableHref=!0,(n=e.id.split("_")[1])===this.config.currentid?(MODx.msg.alert("",_("resource_err_own_parent")),!1):(this.fireEvent("end",{value:"modContext"!==e.attributes.type?n:e.attributes.pk,display:Ext.util.Format.stripTags(e.text),context:e.attributes.ctx}),t.preventDefault(),t.stopEvent(),!0))}},{xtype:"modx-combo",fieldLabel:_("babel.target_pagetitle"),name:"page_id",anchor:"100%",url:s.config.connectorUrl,baseParams:{action:"mgr/resource/getlist",context:n,combo:!0},displayField:"pagetitle",valueField:"id",fields:["id","pagetitle"],editable:!0,typeAhead:!0,forceSelection:!0,listeners:{select:{fn:function(e,t){var n=e.getValue();""===n||0===n||"&nbsp;"===n?e.setValue(null):o.fp.getForm().findField("target").setValue(t.get("id")),o.fp.getForm().findField("target-combo").reset()},scope:this},blur:{fn:function(e){var t=e.getValue();""!==t&&0!==t&&"&nbsp;"!==t||e.setValue(null)},scope:this}}},{fieldLabel:_("babel.target_id"),xtype:"numberfield",name:"target",anchor:"100%",enableKeyEvents:!0,listeners:{keyup:{fn:function(){o.fp.getForm().findField("target-combo").reset(),o.fp.getForm().findField("page_id").reset()},scope:this}}},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_tranlations_target"),name:"sync",checked:!0}]}));o.show()},unlinkTranslation:function(e,t,n,s){e=e||"",n=parseInt(n)||0,t=t||MODx.request.id;var o=this,a=0===n?_("babel.unlink_all_translations_confirm"):_("babel.unlink_translation_confirm",{context:e,id:t});return o.loadMask(),MODx.msg.confirm({title:_("confirm"),text:a,url:this.config.connectorUrl,params:{action:"mgr/resource/unlink",id:t,context:e,target:n},listeners:{success:{fn:function(e){MODx.msg.status({title:_("success"),message:e.message||_("save_successful")}),s?s.refresh():o.getMenu(e.object.menu),o.hideMask()},scope:this},failure:{fn:o.hideMask,scope:this},cancel:{fn:o.hideMask,scope:this}}})},createTranslation:function(t,n=0){var s,o=this;n=n||MODx.request.id,this.loadMask(),t?(s=MODx.load({xtype:"modx-window",title:_("babel.create_translation"),closeAction:"close",buttons:[{text:_("close"),handler:function(){s.close()},scope:this},{text:_("create"),cls:"primary-button",handler:function(){var e=s.fp.getForm().getValues();MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",context_key:t,id:n,copy:e.copy,sync:e.sync},listeners:{success:{fn:function(e){o.hideMask(),MODx.loadPage("resource/update","id="+e.object.id)},scope:this}}})},scope:this}],listeners:{beforeSubmit:{fn:o.loadMask,scope:this},close:{fn:o.hideMask,scope:this}},fields:[{style:"padding-top: 15px",html:"<p>"+_("babel.create_translation_confirm",{context:t,id:n})+"</p>"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_tranlations"),name:"sync",checked:!0}]})).show():Babel.config.hasOwnProperty("menu")&&Babel.config.hasOwnProperty("context_key")?(o.babelMenu=Babel.config.menu,o.babelContext=Babel.config.context_key,o.createTranslations(t,n)):MODx.Ajax.request({url:o.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:n},listeners:{success:{fn:function(e){e.object.menu&&e.object.context_key&&(o.babelMenu=e.object.menu,o.babelContext=e.object.context_key,o.createTranslations(t,n))},scope:this}}})},createTranslations:function(e,t){var n,s=this,o=[];Ext.each(Babel.config.contexts,function(e){e===s.babelContext||!s.babelMenu.hasOwnProperty(e)||"undefined"!==s.babelMenu[e].resourceUrl&&""!==s.babelMenu[e].resourceUrl&&"#"!==s.babelMenu[e].resourceUrl||o.push({boxLabel:s.babelMenu[e].displayText,name:"contexts",inputValue:e})}),o.length?(n=MODx.load({xtype:"modx-window",title:_("babel.create_multiple_translations"),closeAction:"close",buttons:[{text:_("close"),handler:function(){n.close()},scope:this},{text:_("create"),cls:"primary-button",handler:function(){var e=n.fp.getForm().getValues();n.close(),s.addTranslation(t,e)},scope:this}],listeners:{beforeSubmit:{fn:s.loadMask,scope:this},close:{fn:s.hideMask,scope:this},afterrender:function(){var e=Ext.getCmp("babel-all-contexts");e&&e.setValue(1)}},fields:[{xtype:"fieldset",cls:"x-fieldset-check-all",title:_("babel.contexts"),defaults:{hideLabel:!0},items:[{xtype:"xcheckbox",id:"babel-all-contexts",boxLabel:_("babel.all"),itemCls:"x-form-item-check-all",submitValue:!1,listeners:{check:{fn:function(t){var n=[],e=Ext.getCmp("babel-contexts");Ext.each(Babel.config.contexts,function(e){e!==s.babelContext&&s.babelMenu.hasOwnProperty(e)&&n.push(t.getValue())}),e.setValue(n)},scope:this}}},{xtype:"checkboxgroup",id:"babel-contexts",columns:3,anchor:"100%",style:"margin-top: -10px",items:o}]},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.copy_tv_values"),name:"copy"},{xtype:"xcheckbox",hideLabel:!0,boxLabel:_("babel.sync_linked_tranlations"),name:"sync",checked:!0}]})).show():(MODx.msg.alert("",_("babel.create_multiple_translations_err_no_contexts")),s.hideMask())},addTranslation:function(e,t){var n=this,s=(this.contexts=t.hasOwnProperty("contexts")?Array.isArray(t.contexts)?t.contexts:[t.contexts]:[],delete t.contexts,"/babelduplicate/");this.console=MODx.load({xtype:"modx-console",register:"mgr",topic:s,show_filename:!1,clear:!0,listeners:{complete:{fn:function(){var e=MODx.request.id,e=(MODx.msg.status({title:_("success"),message:_("babel.create_multiple_translations_finished")}),MODx.Ajax.request({url:n.config.connectorUrl,params:{action:"mgr/resource/getmenu",id:e},listeners:{success:{fn:function(e){n.hideMask(),e.object.menu&&n.getMenu(e.object.menu),"resource/update"===MODx.request.a&&MODx.loadPage("resource/update","id="+MODx.request.id)},scope:this}}}),Ext.getCmp("modx-resource-tree"));e&&e.rendered&&e.refresh(),n.hideMask()},scope:this}}}),this.console.show(Ext.getBody()),n.requestTranslation(0,s,e,t)},requestTranslation:function(e,t,n,s){var o=this;MODx.Ajax.request({url:this.config.connectorUrl,params:{action:"mgr/resource/duplicate",register:"mgr",topic:t,id:n,context_key:o.contexts[e],last:e===o.contexts.length-1,copy:s.copy,sync:s.sync},listeners:{success:{fn:function(){(e+=1)<o.contexts.length&&o.requestTranslation(e,t,n,s)},scope:this},failure:{fn:function(){(e+=1)<o.contexts.length&&o.requestTranslation(e,t,n,s)},scope:this}}})},loadMask:function(){var e;this.overlayMask||(e=Ext.getBody().dom,this.overlayMask=new Ext.LoadMask(e,{msg:_("babel.please_wait")})),this.overlayMask.show()},hideMask:function(){this.overlayMask&&this.overlayMask.hide()},aboutWindow:function(){Ext.Msg.show({title:_("babel")+" "+Babel.config.version,msg:'&copy; 2010-2024 by Jakob Class<br><br>Authors: <a href="https://github.com/mikrobi">Jakob Class</a>, <a href="https://github.com/goldsky">Rico Goldsky</a>, <a href="https://github.com/JoshuaLuckers">Joshua Luckers</a>, <a href="https://github.com/Jako">Thomas Jakobi</a><br><br>Repository: <a href="https://github.com/mikrobi/babel">github.com/mikrobi/babel</a>',buttons:Ext.Msg.OK,cls:"babel_window",width:358})}}),Ext.reg("babel",babel),new babel);